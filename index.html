<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üöõ ŸÖÿ∫ÿßŸÖÿ±ÿ© ÿ≥ŸÑÿßŸÖÿ© ÿßŸÑÿ∫ÿ∞ÿßÿ° ‚Äì ÿ•ÿµÿØÿßÿ± ÿßŸÑŸÜŸÇŸÑ</title>
  <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Cairo:wght@300;400;600;700&family=Scheherazade+New:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/qrious@4.0.2/dist/qrious.min.js"></script>
  <style>
    :root {
      --primary: #2E7D32; /* green */
      --primary-600: #1B5E20;
      --secondary: #2F3A3B; /* dark slate */
      --accent: #AF9961; /* muted gold */
      --muted: #ECEFF1; /* light gray */
      --ink: #253033;
      --ink-soft: #4a5b60;
      --paper: #ffffff;
      --success-bg: #E8F5E9; /* subtle green */
      --danger-bg: #FDECEA; /* subtle red */
      --success-border: #A5D6A7;
      --danger-border: #FFCDD2;
    }

    html, body { height: 100%; }
    html { font-size: 140%; }
    body {
      font-family: 'Amiri', 'Cairo', 'Scheherazade New', serif;
      margin: 0;
      padding-bottom: 90px;
      color: var(--ink);
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
    }

    header {
      background: linear-gradient(90deg, var(--secondary), var(--primary));
      color: white;
      padding: 0.75rem 1.25rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 5;
      box-shadow: 0 2px 8px rgba(0,0,0,0.12);
    }
    header img { height: 56px; }
    header h1 {
      flex-grow: 1;
      text-align: center;
      margin: 0;
      font-family: 'Amiri', serif;
      font-size: 50px;
      letter-spacing: .5px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    

    .container {
      max-width: 900px;
      margin: 2rem auto;
      padding: 1.5rem;
      background: var(--paper);
      border-radius: 20px;
      box-shadow:
        0 8px 32px rgba(0,0,0,0.12),
        0 2px 8px rgba(0,0,0,0.08);
      border: 2px solid #E0E6EA;
      position: relative;
      overflow: hidden;
    }
    
    .container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #2E7D32, #43A047, #66BB6A, #81C784);
    }

    /* Per-category theme ring for the whole question box */
    #quizBox.qtheme-cool { box-shadow: 0 0 0 6px #1e88e533 inset, 0 1px 0 #00000008, 0 6px 14px rgba(0,0,0,0.10), 0 18px 40px rgba(0,0,0,0.08); }
    #quizBox.qtheme-clean { box-shadow: 0 0 0 6px #00acc133 inset, 0 1px 0 #00000008, 0 6px 14px rgba(0,0,0,0.10), 0 18px 40px rgba(0,0,0,0.08); }
    #quizBox.qtheme-transport { box-shadow: 0 0 0 6px #43A04733 inset, 0 1px 0 #00000008, 0 6px 14px rgba(0,0,0,0.10), 0 18px 40px rgba(0,0,0,0.08); }
    #quizBox.qtheme-pack { box-shadow: 0 0 0 6px #8D6E6333 inset, 0 1px 0 #00000008, 0 6px 14px rgba(0,0,0,0.10), 0 18px 40px rgba(0,0,0,0.08); }
    #quizBox.qtheme-label { box-shadow: 0 0 0 6px #F57C0033 inset, 0 1px 0 #00000008, 0 6px 14px rgba(0,0,0,0.10), 0 18px 40px rgba(0,0,0,0.08); }

    /* Remove gradients: keep a clean solid surface */
    #quizBox.qtheme-cool,
    #quizBox.qtheme-clean,
    #quizBox.qtheme-transport,
    #quizBox.qtheme-pack,
    #quizBox.qtheme-label { background-image: none; background: var(--paper); }

    .question {
      font-family: 'Amiri', serif;
      font-size: 38px;
      color: #1e1e1e;
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      gap: 12px;
      line-height: 1.4;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }
    .question::before { content: ''; }
    .qicon { display:none; }
    .qicon.cool { color: #1e88e5; }
    .qicon.clean { color: #00acc1; }
    .qicon.transport { color: #43A047; }
    .qicon.pack { color: #8D6E63; }
    .qicon.label { color: #F57C00; }

    .qbadge {
      display: inline-block;
      margin-right: 8px;
      padding: 4px 10px;
      border-radius: 999px;
      font-family: 'Cairo', sans-serif;
      font-weight: 600;
      font-size: 0.65em;
      vertical-align: middle;
      border: 2px solid #00000012;
      background: #fff;
    }
    .qbadge.cool { background: #bbdefb; color: #0d47a1; }
    .qbadge.clean { background: #b2ebf2; color: #006064; }
    .qbadge.transport { background: #c8e6c9; color: #1b5e20; }
    .qbadge.pack { background: #e1bee7; color: #4a148c; }
    .qbadge.label { background: #ffe0b2; color: #e65100; }

    .options { list-style: none; padding: 0; margin: 0; }
    .options li {
      position: relative;
      background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
      margin: 0.8rem 0;
      padding: 1.2rem 1.4rem;
      border-radius: 16px;
      cursor: pointer;
      font-size: 1.1em;
      font-family: 'Cairo', sans-serif;
      font-weight: 500;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08), 0 2px 4px rgba(0,0,0,0.04);
      border: 2px solid #E0E6EA;
      transform: translateY(0);
    }
    
    .options li::before {
      content: 'üìã';
      margin-left: 8px;
      font-size: 1.2em;
    }
    .options li:hover { 
      transform: translateY(-3px) scale(1.02); 
      box-shadow: 0 8px 25px rgba(0,0,0,0.15), 0 4px 8px rgba(0,0,0,0.08);
      border-color: #2E7D32;
    }
    .options li::before { content: ''; }
    .options li.correct {
      background: linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%);
      border-color: #4CAF50;
      color: #1B5E20;
      transform: scale(1.05);
      box-shadow: 0 8px 25px rgba(76, 175, 80, 0.3);
    }
    
    .options li.correct::before {
      content: '‚úÖ';
    }
    .options li.incorrect {
      background: linear-gradient(135deg, #FDECEA 0%, #FFCDD2 100%);
      border-color: #F44336;
      color: #C62828;
      transform: scale(0.98);
    }
    
    .options li.incorrect::before {
      content: '‚ùå';
    }

    #score {
      margin-top: 1rem;
      font-weight: 700;
      color: #1d3b2f;
      text-align: center;
      background: linear-gradient(90deg, #fff, #f9f9f9);
      border-radius: 10px;
      padding: 8px 12px;
      border: 2px solid #e8e8e8;
      display: inline-block;
      min-width: 220px;
      font-size: 1em;
    }

    #certificate {
      display: none;
      text-align: center;
      padding: 2rem 1.2rem 3rem;
    }
    #certificate .card {
      margin: 0 auto;
      max-width: 1000px;
      background: #ffffff;
      border-radius: 12px;
      padding: 2rem 2.5rem;
      border: 1px solid #D8DFE3;
      box-shadow: 0 12px 30px rgba(0,0,0,0.08);
      position: relative;
    }
    #certificate .ribbon { display:none; }
    #certificate h2 {
      color: var(--secondary);
      font-size: 34px;
      font-family: 'Merriweather', serif;
      letter-spacing: .5px;
      margin-bottom: 0.5rem;
    }
    #certificate button {
      margin-top: 1rem;
      background: var(--primary);
      color: #fff;
      border: none;
      padding: 0.65rem 1.25rem;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 700;
      box-shadow: 0 8px 16px rgba(0,0,0,0.12);
    }

    /* Certificate footer */
    .cert-footer {
      display: flex;
      justify-content: space-between;
      gap: 24px;
      margin-top: 28px;
      padding-top: 16px;
      border-top: 1px solid #E0E6EA;
    }
    .sig-block {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
    }
    .sig-text {
      color: var(--secondary);
      font-weight: 600;
      margin-bottom: 10px;
    }
    .sig-line {
      height: 1px;
      background: #B0BEC5;
      margin-top: 18px;
    }
    .sig-label {
      color: var(--ink-soft);
      font-size: 0.85em;
      margin-top: 6px;
    }

    .nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: #ffffff;
      padding: 0.75rem;
      text-align: center;
      z-index: 10;
      box-shadow: 0 -6px 16px rgba(0,0,0,0.06);
    }
    .nav button {
      background: #fff;
      color: #2E4A3B;
      border: 3px solid #00000014;
      padding: 0.6rem 1.1rem;
      margin: 0 0.4rem;
      border-radius: 14px;
      cursor: pointer;
      font-weight: 900;
      font-family: 'Cairo', sans-serif;
      font-size: 1em;
      box-shadow: 0 3px 0 #00000010, 0 10px 16px rgba(0,0,0,0.08);
      transition: transform .08s ease;
    }
    .nav button:hover { transform: translateY(-1px); }
    .nav button:active { transform: translateY(2px); }

    .modal {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #fff;
      border: 1px solid #E0E6EA;
      border-radius: 12px;
      padding: 1rem;
      max-width: 460px;
      width: 90%;
      box-shadow: 0 12px 24px rgba(0,0,0,0.12);
      z-index: 200;
      text-align: center;
      background-image: none;
    }
    .modal h3 { margin-top: 0; color: var(--secondary); font-family: 'Cairo', sans-serif; font-size: 28px; }
    .modal button {
      margin-top: 0.75rem;
      background: var(--primary);
      color: #fff;
      border: none;
      padding: 0.55rem 1.1rem;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 700;
    }

    /* Certificate/Print adjustments */
    body.certificate-mode header img { height: 28px; }
    body.certificate-mode .nav { display: none; }
    @media print {
      @page { size: A4 landscape; margin: 10mm; }
      body { background: #fff !important; }
      header { box-shadow: none; }
      header img { height: 24px !important; }
      .nav, #score { display: none !important; }
      #certificate { display: block !important; }
      #quizBox, .modal { display: none !important; }
      #certificate .card { max-width: 100%; box-shadow: none; border-width: 6px; }
    }

    /* Educational Content Box */
    .edu-content {
      background: linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 100%);
      border: 2px solid #2196F3;
      border-radius: 16px;
      padding: 1.5rem;
      margin: 1.5rem 0;
      box-shadow: 0 6px 20px rgba(33, 150, 243, 0.15);
      position: relative;
      overflow: hidden;
    }
    
    .edu-content::before {
      content: 'üéì';
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 2em;
      opacity: 0.3;
    }
    
    .edu-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 1rem;
      font-family: 'Amiri', serif;
      font-size: 1.4em;
      font-weight: 700;
      color: #1565C0;
    }
    
    .edu-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 1rem;
    }
    
    .edu-tab {
      padding: 8px 16px;
      background: rgba(255,255,255,0.7);
      border: 2px solid #2196F3;
      border-radius: 20px;
      cursor: pointer;
      font-family: 'Cairo', sans-serif;
      font-weight: 600;
      transition: all 0.3s ease;
      font-size: 0.9em;
    }
    
    .edu-tab.active {
      background: #2196F3;
      color: white;
      transform: scale(1.05);
    }
    
    .edu-tab:hover {
      background: #1976D2;
      color: white;
      transform: translateY(-2px);
    }
    
    .edu-content-area {
      min-height: 200px;
      background: rgba(255,255,255,0.8);
      border-radius: 12px;
      padding: 1.5rem;
      border: 1px solid rgba(33, 150, 243, 0.2);
    }
    
    .video-placeholder {
      background: linear-gradient(135deg, #FF6B6B, #4ECDC4);
      border-radius: 12px;
      height: 150px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-family: 'Amiri', serif;
      font-size: 1.2em;
      font-weight: 700;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .video-placeholder::before {
      content: '‚ñ∂Ô∏è';
      font-size: 3em;
      margin-left: 10px;
    }
    
    .video-placeholder:hover {
      transform: scale(1.05);
      box-shadow: 0 8px 25px rgba(0,0,0,0.2);
    }
    
    .infographic-content {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
    }
    
    .info-card {
      background: linear-gradient(135deg, #FFF3E0, #FFE0B2);
      border: 2px solid #FF9800;
      border-radius: 12px;
      padding: 1rem;
      text-align: center;
      transition: all 0.3s ease;
    }
    
    .info-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(255, 152, 0, 0.3);
    }
    
    .info-icon {
      font-size: 2.5em;
      margin-bottom: 0.5rem;
    }
    
    .info-title {
      font-family: 'Amiri', serif;
      font-weight: 700;
      color: #E65100;
      margin-bottom: 0.5rem;
    }
    
    .info-desc {
      font-family: 'Cairo', sans-serif;
      font-size: 0.9em;
      color: #BF360C;
      line-height: 1.4;
    }
    
    /* Auto-advance feature */
    .auto-advance {
      background: linear-gradient(135deg, #E8F5E9, #C8E6C9);
      border: 2px solid #4CAF50;
      border-radius: 12px;
      padding: 1rem;
      margin: 1rem 0;
      text-align: center;
      font-family: 'Cairo', sans-serif;
      font-weight: 600;
      color: #1B5E20;
    }
    
    .countdown {
      font-size: 1.5em;
      font-weight: 700;
      color: #2E7D32;
      margin: 0.5rem 0;
    }
    
    /* Progress bar */
    .progress-container {
      background: rgba(255,255,255,0.3);
      border-radius: 10px;
      height: 8px;
      margin: 1rem 0;
      overflow: hidden;
    }
    
    .progress-bar {
      background: linear-gradient(90deg, #2E7D32, #4CAF50, #66BB6A);
      height: 100%;
      width: 0%;
      transition: width 0.5s ease;
      border-radius: 10px;
    }
    
    /* Animations */
    @keyframes slideInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    .slide-in {
      animation: slideInUp 0.6s ease-out;
    }
    
    .pulse {
      animation: pulse 2s infinite;
    }
  </style>
</head>
<body>
<header>
  <img src="logo-left.png" alt="Left Logo" />
  <h1>üöõ ŸÖÿ∫ÿßŸÖÿ±ÿ© ÿ≥ŸÑÿßŸÖÿ© ÿßŸÑÿ∫ÿ∞ÿßÿ° ‚Äì ÿ•ÿµÿØÿßÿ± ÿßŸÑŸÜŸÇŸÑ</h1>
  <img src="logo-right.png" alt="Right Logo" />
  </header>

<div class="container" id="quizBox">
  <!-- Progress Bar -->
  <div class="progress-container">
    <div class="progress-bar" id="progressBar"></div>
  </div>
  
  <!-- Educational Content Box -->
  <div class="edu-content" id="eduContent">
    <div class="edu-header">
      <span>üéì</span>
      <span>ŸÖÿ≠ÿ™ŸàŸâ ÿ™ÿπŸÑŸäŸÖŸä</span>
    </div>
    <div class="edu-tabs">
      <div class="edu-tab active" onclick="switchEduTab('video')">üìπ ŸÅŸäÿØŸäŸà ÿ™ÿπŸÑŸäŸÖŸä</div>
      <div class="edu-tab" onclick="switchEduTab('info')">üìä ŸÖÿπŸÑŸàŸÖÿßÿ™Ÿäÿ©</div>
      <div class="edu-tab" onclick="switchEduTab('tips')">üí° ŸÜÿµÿßÿ¶ÿ≠</div>
    </div>
    <div class="edu-content-area" id="eduContentArea">
      <!-- Content will be loaded dynamically -->
    </div>
  </div>
  
  <div class="question" id="question"></div>
  <ul class="options" id="options"></ul>
  
  <!-- Auto-advance notification -->
  <div class="auto-advance" id="autoAdvance" style="display: none;">
    <div>‚è∞ ÿ≥Ÿäÿ™ŸÖ ÿßŸÑÿßŸÜÿ™ŸÇÿßŸÑ ŸÑŸÑÿ≥ÿ§ÿßŸÑ ÿßŸÑÿ™ÿßŸÑŸä ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ÿÆŸÑÿßŸÑ:</div>
    <div class="countdown" id="countdown">5</div>
  </div>
  
  <div style="text-align:center"><div id="score">üìä ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ©: 0 / 0</div></div>
  </div>

<div id="certificate">
  <div class="card">
    <div class="ribbon">üéâ ÿ™ŸáÿßŸÜŸäŸÜÿß! üéâ</div>
    <h2>üéì ÿ¥ŸáÿßÿØÿ© ÿ•ÿ™ŸÖÿßŸÖ ÿßŸÑÿØŸàÿ±ÿ©</h2>
    <p>Ÿáÿ∞Ÿá ÿßŸÑÿ¥ŸáÿßÿØÿ© ÿ™ÿ§ŸÉÿØ ÿ£ŸÜ <strong id="userName">ŸÖÿ≠ŸÖÿØ</strong> ŸÇÿØ ÿ£ÿ™ŸÖ ÿ®ŸÜÿ¨ÿßÿ≠</p>
    <p><em>ÿØŸàÿ±ÿ© ÿ≥ŸÑÿßŸÖÿ© ŸÜŸÇŸÑ ÿßŸÑÿ∫ÿ∞ÿßÿ°</em></p>
    <p>ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ© ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿ©: <strong id="finalScore">0/0</strong></p>
    <div id="categoryStats" style="margin-top:12px"></div>
    <div id="certMeta" style="margin-top:8px; color:#556; font-size:.9rem; display:flex; gap:12px; justify-content:center; align-items:center; flex-wrap:wrap">
      <canvas id="certQr" width="96" height="96" style="border:1px solid #E0E6EA; border-radius:6px; background:#fff"></canvas>
    </div>
    <div class="cert-footer">
      <div class="sig-block">
        <div class="sig-text">ÿ®ŸÑÿØŸäÿ© ŸÖÿØŸäŸÜÿ© ÿßŸÑÿ¥ÿßÿ±ŸÇÿ© ‚Äì ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ±ŸÇÿßÿ®ÿ© ÿßŸÑÿµÿ≠Ÿäÿ© ŸàÿßŸÑÿ≥ŸÑÿßŸÖÿ©</div>
        <div class="sig-line"></div>
        <div class="sig-label">ÿßŸÑÿ™ŸàŸÇŸäÿπ ÿßŸÑŸÖÿπÿ™ŸÖÿØ</div>
      </div>
      <div class="sig-block" style="max-width: 260px; align-items:flex-end;">
        <div class="sig-text" id="certDate">‚Äî</div>
        <div class="sig-line" style="width:100%"></div>
        <div class="sig-label">ÿßŸÑÿ™ÿßÿ±ŸäÿÆ</div>
      </div>
    </div>
    <div style="margin-top:12px; display:flex; gap:12px; justify-content:center; align-items:center; flex-wrap:wrap">
      <button onclick="window.print()">üñ®Ô∏è ÿ∑ÿ®ÿßÿπÿ© ÿßŸÑÿ¥ŸáÿßÿØÿ©</button>
      <button id="resetBtn" type="button" style="background:#fff;color:#2F3A3B;border:1px solid #CBD5E1">‚Ü∫ ÿ•ÿπÿßÿØÿ© ÿßŸÑŸÉŸàŸäÿ≤</button>
    </div>
  </div>
  </div>

<div class="nav">
  <button onclick="prevQuestion()">‚¨ÖÔ∏è ÿßŸÑÿ≥ÿßÿ®ŸÇ</button>
  <button onclick="nextQuestion()">ÿßŸÑÿ™ÿßŸÑŸä ‚û°Ô∏è</button>
  </div>

<div class="modal" id="feedbackModal">
  <h3>üí° ŸÜÿµŸäÿ≠ÿ©</h3>
  <p id="modalContent"></p>
  <button onclick="closeModal()">ŸÖÿ™ÿßÿ®ÿπÿ©</button>
  </div>
<script>
  let quizzes = [];
  let current = 0;
  let score = 0;
  let answered = {};
  let answeredCorrect = {};
  let autoAdvanceTimer = null;
  let currentEduTab = 'video';

  function seedFallbackQuizzes() {
    return [
      {
        id: 1,
        question: 'ŸÖÿß ŸáŸä ÿØÿ±ÿ¨ÿ© ÿßŸÑÿ≠ÿ±ÿßÿ±ÿ© ÿßŸÑÿ¢ŸÖŸÜÿ© ŸÑŸÜŸÇŸÑ ÿßŸÑÿ£ÿ∑ÿπŸÖÿ© ÿßŸÑŸÇÿßÿ®ŸÑÿ© ŸÑŸÑÿ™ŸÑŸÅÿü',
        options: ['0-5¬∞C', '10-15¬∞C', '20-25¬∞C', 'ÿ£Ÿä ÿØÿ±ÿ¨ÿ© ÿ≠ÿ±ÿßÿ±ÿ©'],
        answer: 0,
        explanation: 'Ÿäÿ¨ÿ® ÿßŸÑÿ≠ŸÅÿßÿ∏ ÿπŸÑŸâ ÿßŸÑÿ£ÿ∑ÿπŸÖÿ© ÿßŸÑŸÖÿ®ÿ±ÿØÿ© ÿπÿßÿØÿ© ÿπŸÜÿØ 0-5¬∞C ŸÑŸÖŸÜÿπ ŸÜŸÖŸà ÿßŸÑÿ®ŸÉÿ™Ÿäÿ±Ÿäÿß.'
      },
      {
        id: 2,
        question: 'ÿ£Ÿä ŸÖŸÖÿßÿ±ÿ≥ÿ© ÿ™ŸÇŸÑŸÑ ŸÖŸÜ ÿßŸÑÿ™ŸÑŸàÿ´ ÿßŸÑŸÖÿ™ÿ®ÿßÿØŸÑ ÿ£ÿ´ŸÜÿßÿ° ÿßŸÑŸÜŸÇŸÑÿü',
        options: ['ÿÆŸÑÿ∑ ÿßŸÑÿ£ÿ∑ÿπŸÖÿ© ÿßŸÑŸÜŸäÿ¶ÿ© ŸàÿßŸÑŸÖÿ∑ÿ®ŸàÿÆÿ©', 'ÿ≠ÿßŸàŸäÿßÿ™ ŸÖŸÜŸÅÿµŸÑÿ© ŸàŸÖÿÆÿ™ŸàŸÖÿ©', 'ŸÑÿß ÿ≠ÿßÿ¨ÿ© ŸÑŸÑÿ™Ÿàÿ≥ŸäŸÖ', 'ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ŸÜŸÅÿ≥ ÿßŸÑÿ£ÿØŸàÿßÿ™'],
        answer: 1,
        explanation: 'ÿßŸÑÿ≠ÿßŸàŸäÿßÿ™ ÿßŸÑŸÖŸÜŸÅÿµŸÑÿ© ŸàÿßŸÑŸÖÿÆÿ™ŸàŸÖÿ© ŸàÿßŸÑÿ™Ÿàÿ≥ŸäŸÖ Ÿäÿ≥ÿßÿπÿØÿßŸÜ ŸÅŸä ÿ™ÿ¨ŸÜÿ® ÿßŸÑÿ™ŸÑŸàÿ´ ÿßŸÑŸÖÿ™ÿ®ÿßÿØŸÑ.'
      },
      {
        id: 3,
        question: 'ŸÖÿßÿ∞ÿß Ÿäÿ¨ÿ® ŸÅÿπŸÑŸá ŸÇÿ®ŸÑ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ∑ÿπÿßŸÖÿü',
        options: ['ÿ™ÿ¨ÿßŸáŸÑ ŸÜÿ∏ÿßŸÅÿ© ÿßŸÑŸÖÿ±ŸÉÿ®ÿ©', 'ÿ™ÿπŸÇŸäŸÖ ÿ£ÿ≥ÿ∑ÿ≠ ÿßŸÑŸÖÿ±ŸÉÿ®ÿ©', 'ÿ•ŸäŸÇÿßŸÅ ÿßŸÑÿ™ÿ®ÿ±ŸäÿØ', 'ÿ™ÿÆÿ∑Ÿä ÿßŸÑŸÅÿ≠Ÿàÿµÿßÿ™'],
        answer: 1,
        explanation: 'ÿßŸÑÿ™ÿπŸÇŸäŸÖ ŸäŸÇŸÑŸÑ ŸÖŸÜ ŸÖÿÆÿßÿ∑ÿ± ÿßŸÑÿ™ŸÑŸàÿ´ÿõ ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿπŸÖŸÑ ÿßŸÑÿ™ÿ®ÿ±ŸäÿØ ŸÇÿ®ŸÑ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ.'
      }
    ];
  }

  fetch('quizzes.json')
    .then(res => res.ok ? res.json() : Promise.reject())
    .then(data => {
      quizzes = data.quizzes || seedFallbackQuizzes();
      showQuestion();
      updateScore();
    })
    .catch(() => {
      quizzes = seedFallbackQuizzes();
      showQuestion();
      updateScore();
    });

  function showQuestion() {
    const q = quizzes[current];
    if (!q) return;
    
    // Update progress bar
    updateProgressBar();
    
    // Load educational content
    loadEducationalContent(q);
    
    const manualType = normalizeType(q.category);
    const type = manualType || detectType(q.question);
    const icon = '';
    const qEl = document.getElementById('question');
    const badge = type ? `<span class="qbadge ${type}">${type}</span>` : '';
    qEl.innerHTML = `${badge} Q${q.id}: ${q.question}`;
    qEl.classList.add('slide-in');
    
    const box = document.getElementById('quizBox');
    box.classList.remove('qtheme-cool','qtheme-clean','qtheme-transport','qtheme-pack','qtheme-label');
    if (type) box.classList.add(`qtheme-${type}`);
    
    const optionsList = document.getElementById('options');
    optionsList.innerHTML = '';

    q.options.forEach((opt, i) => {
      const li = document.createElement('li');
      li.textContent = opt;
      li.onclick = () => {
        if (answered[current]) return;
        answered[current] = true;
        
        // Clear auto-advance timer
        if (autoAdvanceTimer) {
          clearTimeout(autoAdvanceTimer);
          autoAdvanceTimer = null;
        }
        document.getElementById('autoAdvance').style.display = 'none';
        
        if (i === q.answer) {
          li.classList.add('correct');
          score++;
          answeredCorrect[current] = true;
        } else {
          li.classList.add('incorrect');
          if (optionsList.children[q.answer]) {
            optionsList.children[q.answer].classList.add('correct');
          }
          answeredCorrect[current] = false;
        }
        updateScore();
        
        // Auto-advance after 3 seconds
        startAutoAdvance();
      };
      optionsList.appendChild(li);
    });
  }

  function detectType(text) {
    const t = (text || '').toLowerCase();
    if (/(temp|cold|chill|cool|¬∞|c|cold chain|freeze|refriger)/.test(t)) return 'cool';
    if (/(sanitize|clean|hygiene|wash|disinfect|cleanliness)/.test(t)) return 'clean';
    if (/(transport|truck|deliver|vehicle|load|unload|route)/.test(t)) return 'transport';
    if (/(pack|seal|container|package|wrap|box)/.test(t)) return 'pack';
    if (/(label|expiry|date|trace|tag)/.test(t)) return 'label';
    return '';
  }

  function detectIcon(text) {
    const t = (text || '').toLowerCase();
    if (/(temp|cold|chill|cool|¬∞|c|cold chain|freeze|refriger)/.test(t)) return 'üßä';
    if (/(sanitize|clean|hygiene|wash|disinfect|sanitize|cleanliness)/.test(t)) return 'üßº';
    if (/(transport|truck|deliver|vehicle|load|unload|route)/.test(t)) return 'üöö';
    if (/(pack|seal|container|package|wrap|box)/.test(t)) return 'ü•°';
    if (/(label|expiry|date|trace|tag)/.test(t)) return 'üè∑Ô∏è';
    return 'üçΩÔ∏è';
  }

  function normalizeType(category) {
    if (!category) return '';
    const t = String(category).toLowerCase().trim();
    if (/^(temp|cold|cool|chill|freeze|refriger|temperature|cold\s*chain)$/.test(t)) return 'cool';
    if (/^(clean|cleaning|hygiene|wash|sanitize|sanitization|disinfect)$/.test(t)) return 'clean';
    if (/^(transport|delivery|vehicle|logistics|route|loading)$/.test(t)) return 'transport';
    if (/^(pack|packaging|seal|container|boxing|wrapping)$/.test(t)) return 'pack';
    if (/^(label|labelling|labeling|expiry|expiration|trace|traceability|tag)$/.test(t)) return 'label';
    return '';
  }

  function iconForType(type) {
    switch (type) {
      case 'cool': return 'üßä';
      case 'clean': return 'üßº';
      case 'transport': return 'üöö';
      case 'pack': return 'ü•°';
      case 'label': return 'üè∑Ô∏è';
      default: return 'üçΩÔ∏è';
    }
  }

  function nextQuestion() {
    if (current < quizzes.length - 1) {
      current++;
      showQuestion();
    } else {
      showCertificate();
    }
  }

  function closeModal() {
    document.getElementById('feedbackModal').style.display = 'none';
    nextQuestion();
  }

  function prevQuestion() {
    if (current > 0) {
      current--;
      showQuestion();
    }
  }

  function updateScore() {
    const el = document.getElementById('score');
    if (el) el.textContent = `üìä ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ©: ${score} / ${quizzes.length}`;
  }
  
  function updateProgressBar() {
    const progress = ((current + 1) / quizzes.length) * 100;
    const progressBar = document.getElementById('progressBar');
    if (progressBar) {
      progressBar.style.width = progress + '%';
    }
  }
  
  function loadEducationalContent(question) {
    const type = normalizeType(question.category) || detectType(question.question);
    const contentArea = document.getElementById('eduContentArea');
    
    if (currentEduTab === 'video') {
      contentArea.innerHTML = `
        <div class="video-placeholder" onclick="playVideo('${type}')">
          <div>
            <div>ÿ¥ÿßŸáÿØ ÿßŸÑŸÅŸäÿØŸäŸà ÿßŸÑÿ™ÿπŸÑŸäŸÖŸä</div>
            <div style="font-size: 0.8em; margin-top: 5px; opacity: 0.9;">
              ${getVideoTitle(type)}
            </div>
          </div>
        </div>
      `;
    } else if (currentEduTab === 'info') {
      contentArea.innerHTML = `
        <div class="infographic-content">
          ${getInfographicContent(type)}
        </div>
      `;
    } else if (currentEduTab === 'tips') {
      contentArea.innerHTML = `
        <div style="font-family: 'Cairo', sans-serif; line-height: 1.6;">
          <h4 style="color: #1565C0; margin-bottom: 1rem;">üí° ŸÜÿµÿßÿ¶ÿ≠ ŸÖŸáŸÖÿ©:</h4>
          ${getTipsContent(type)}
        </div>
      `;
    }
  }
  
  function switchEduTab(tab) {
    currentEduTab = tab;
    
    // Update tab styles
    document.querySelectorAll('.edu-tab').forEach(t => t.classList.remove('active'));
    event.target.classList.add('active');
    
    // Reload content
    const q = quizzes[current];
    if (q) loadEducationalContent(q);
  }
  
  function getVideoTitle(type) {
    const titles = {
      'cool': 'ÿßŸÑÿ™ÿ≠ŸÉŸÖ ŸÅŸä ÿØÿ±ÿ¨ÿ© ÿßŸÑÿ≠ÿ±ÿßÿ±ÿ©',
      'clean': 'ÿßŸÑŸÜÿ∏ÿßŸÅÿ© ŸàÿßŸÑÿ™ÿπŸÇŸäŸÖ',
      'transport': 'ŸÜŸÇŸÑ ÿßŸÑÿ∫ÿ∞ÿßÿ° ÿßŸÑÿ¢ŸÖŸÜ',
      'pack': 'ÿßŸÑÿ™ÿπÿ®ÿ¶ÿ© ŸàÿßŸÑÿ™ÿ∫ŸÑŸäŸÅ',
      'label': 'ÿßŸÑÿ™Ÿàÿ≥ŸäŸÖ ŸàÿßŸÑÿ™Ÿàÿ´ŸäŸÇ'
    };
    return titles[type] || 'ÿ≥ŸÑÿßŸÖÿ© ÿßŸÑÿ∫ÿ∞ÿßÿ° ÿßŸÑÿπÿßŸÖÿ©';
  }
  
  function getInfographicContent(type) {
    const content = {
      'cool': `
        <div class="info-card">
          <div class="info-icon">üßä</div>
          <div class="info-title">ÿØÿ±ÿ¨ÿ© ÿßŸÑÿ≠ÿ±ÿßÿ±ÿ©</div>
          <div class="info-desc">0-5¬∞C ŸÑŸÑÿ£ÿ∑ÿπŸÖÿ© ÿßŸÑŸÖÿ®ÿ±ÿØÿ©<br>-18¬∞C ŸÑŸÑÿ£ÿ∑ÿπŸÖÿ© ÿßŸÑŸÖÿ¨ŸÖÿØÿ©</div>
        </div>
        <div class="info-card">
          <div class="info-icon">üå°Ô∏è</div>
          <div class="info-title">ÿßŸÑŸÖÿ±ÿßŸÇÿ®ÿ©</div>
          <div class="info-desc">ŸÅÿ≠ÿµ ÿØŸàÿ±Ÿä ŸÉŸÑ ÿ≥ÿßÿπÿ™ŸäŸÜ<br>ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑŸÇÿ±ÿßÿ°ÿßÿ™</div>
        </div>
        <div class="info-card">
          <div class="info-icon">‚ùÑÔ∏è</div>
          <div class="info-title">ÿßŸÑÿ™ÿ®ÿ±ŸäÿØ</div>
          <div class="info-desc">Ÿàÿ≠ÿØÿßÿ™ ÿ™ÿ®ÿ±ŸäÿØ ŸÖŸÜÿßÿ≥ÿ®ÿ©<br>ÿπÿ≤ŸÑ ÿ¨ŸäÿØ ŸÑŸÑÿ≠ÿ±ÿßÿ±ÿ©</div>
        </div>
      `,
      'clean': `
        <div class="info-card">
          <div class="info-icon">üßº</div>
          <div class="info-title">ÿßŸÑÿ™ŸÜÿ∏ŸäŸÅ</div>
          <div class="info-desc">ÿ™ŸÜÿ∏ŸäŸÅ ŸäŸàŸÖŸä ÿ¥ÿßŸÖŸÑ<br>ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ŸÖŸàÿßÿØ ŸÖÿπŸÇŸÖÿ©</div>
        </div>
        <div class="info-card">
          <div class="info-icon">ü¶†</div>
          <div class="info-title">ŸÖŸÜÿπ ÿßŸÑÿ™ŸÑŸàÿ´</div>
          <div class="info-desc">ŸÅÿµŸÑ ÿßŸÑÿ£ÿ∑ÿπŸÖÿ© ÿßŸÑŸÜŸäÿ¶ÿ©<br>ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿ£ÿØŸàÿßÿ™ ŸÖŸÜŸÅÿµŸÑÿ©</div>
        </div>
        <div class="info-card">
          <div class="info-icon">üë®‚Äçüç≥</div>
          <div class="info-title">ÿßŸÑŸÜÿ∏ÿßŸÅÿ© ÿßŸÑÿ¥ÿÆÿµŸäÿ©</div>
          <div class="info-desc">ÿ∫ÿ≥ŸÑ ÿßŸÑŸäÿØŸäŸÜ<br>ÿßÿ±ÿ™ÿØÿßÿ° ÿßŸÑŸÇŸÅÿßÿ≤ÿßÿ™</div>
        </div>
      `,
      'transport': `
        <div class="info-card">
          <div class="info-icon">üöö</div>
          <div class="info-title">ÿßŸÑŸÖÿ±ŸÉÿ®ÿ©</div>
          <div class="info-desc">ÿµŸäÿßŸÜÿ© ÿØŸàÿ±Ÿäÿ©<br>ÿ™ŸÜÿ∏ŸäŸÅ ÿ¥ÿßŸÖŸÑ</div>
        </div>
        <div class="info-card">
          <div class="info-icon">üì¶</div>
          <div class="info-title">ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ</div>
          <div class="info-desc">ÿ™ÿ±ÿ™Ÿäÿ® ÿµÿ≠Ÿäÿ≠<br>ŸÖŸÜÿπ ÿßŸÑÿ™ŸÑŸÅ</div>
        </div>
        <div class="info-card">
          <div class="info-icon">‚è∞</div>
          <div class="info-title">ÿßŸÑŸàŸÇÿ™</div>
          <div class="info-desc">ÿ™ÿ≥ŸÑŸäŸÖ ÿ≥ÿ±Ÿäÿπ<br>ÿ™ÿ¨ŸÜÿ® ÿßŸÑÿ™ÿ£ÿÆŸäÿ±</div>
        </div>
      `
    };
    return content[type] || content['transport'];
  }
  
  function getTipsContent(type) {
    const tips = {
      'cool': `
        <ul style="list-style: none; padding: 0;">
          <li>‚ùÑÔ∏è ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿπŸÖŸÑ ÿ£ÿ¨Ÿáÿ≤ÿ© ÿßŸÑÿ™ÿ®ÿ±ŸäÿØ ŸÇÿ®ŸÑ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ</li>
          <li>üå°Ô∏è ÿ±ÿßŸÇÿ® ÿØÿ±ÿ¨ÿ© ÿßŸÑÿ≠ÿ±ÿßÿ±ÿ© ŸÉŸÑ ÿ≥ÿßÿπÿ™ŸäŸÜ</li>
          <li>üìù ÿ≥ÿ¨ŸÑ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÇÿ±ÿßÿ°ÿßÿ™ ŸÅŸä ÿßŸÑÿ≥ÿ¨ŸÑ</li>
          <li>üö® ŸÅŸä ÿ≠ÿßŸÑÿ© ÿßŸÑÿπÿ∑ŸÑÿå ÿßŸÜŸÇŸÑ ÿßŸÑÿ®ÿ∂ÿßÿ¶ÿπ ŸÅŸàÿ±ÿßŸã</li>
        </ul>
      `,
      'clean': `
        <ul style="list-style: none; padding: 0;">
          <li>üßº ŸÜÿ∏ŸÅ ÿßŸÑŸÖÿ±ŸÉÿ®ÿ© ŸÇÿ®ŸÑ Ÿàÿ®ÿπÿØ ŸÉŸÑ ÿ±ÿ≠ŸÑÿ©</li>
          <li>ü¶† ÿßÿ≥ÿ™ÿÆÿØŸÖ ŸÖŸàÿßÿØ ŸÖÿπŸÇŸÖÿ© ŸÖÿπÿ™ŸÖÿØÿ©</li>
          <li>üë• ÿØÿ±ÿ® ÿßŸÑÿπŸÖÿßŸÑ ÿπŸÑŸâ ÿßŸÑŸÜÿ∏ÿßŸÅÿ© ÿßŸÑÿ¥ÿÆÿµŸäÿ©</li>
          <li>üìã ÿßÿ≠ÿ™ŸÅÿ∏ ÿ®ÿ≥ÿ¨ŸÑÿßÿ™ ÿßŸÑÿ™ŸÜÿ∏ŸäŸÅ</li>
        </ul>
      `,
      'transport': `
        <ul style="list-style: none; padding: 0;">
          <li>üöõ ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿµŸÑÿßÿ≠Ÿäÿ© ÿßŸÑŸÖÿ±ŸÉÿ®ÿ©</li>
          <li>üì¶ ÿ±ÿ™ÿ® ÿßŸÑÿ®ÿ∂ÿßÿ¶ÿπ ÿ≠ÿ≥ÿ® ÿßŸÑÿ£ŸàŸÑŸàŸäÿ©</li>
          <li>üõ£Ô∏è ÿßÿÆÿ™ÿ± ÿ£ŸÇÿµÿ± ÿ∑ÿ±ŸäŸÇ ÿ¢ŸÖŸÜ</li>
          <li>‚è∞ ÿ™ÿ¨ŸÜÿ® ÿ£ŸàŸÇÿßÿ™ ÿßŸÑÿ∞ÿ±Ÿàÿ©</li>
        </ul>
      `
    };
    return tips[type] || tips['transport'];
  }
  
  function playVideo(type) {
    alert(`ÿ≥Ÿäÿ™ŸÖ ÿ™ÿ¥ÿ∫ŸäŸÑ ŸÅŸäÿØŸäŸà ÿ™ÿπŸÑŸäŸÖŸä ÿπŸÜ: ${getVideoTitle(type)}\n\n(Ÿáÿ∞ÿß ŸÖÿ´ÿßŸÑ - ŸäŸÖŸÉŸÜ ÿ±ÿ®ÿ∑Ÿá ÿ®ŸÅŸäÿØŸäŸà ÿ≠ŸÇŸäŸÇŸä ŸÖŸÜ YouTube ÿ£Ÿà ÿ£Ÿä ŸÖŸÜÿµÿ© ÿ£ÿÆÿ±Ÿâ)`);
  }
  
  function startAutoAdvance() {
    let countdown = 3;
    const countdownEl = document.getElementById('countdown');
    const autoAdvanceEl = document.getElementById('autoAdvance');
    
    autoAdvanceEl.style.display = 'block';
    
    const timer = setInterval(() => {
      countdownEl.textContent = countdown;
      countdown--;
      
      if (countdown < 0) {
        clearInterval(timer);
        autoAdvanceEl.style.display = 'none';
        nextQuestion();
      }
    }, 1000);
    
    autoAdvanceTimer = timer;
  }

  function showCertificate() {
    document.getElementById('quizBox').style.display = 'none';
    document.getElementById('finalScore').textContent = `${score} / ${quizzes.length}`;
    document.getElementById('certificate').style.display = 'block';
    document.body.classList.add('certificate-mode');
    renderCategoryStats();
    const d = new Date();
    const dateStr = d.toLocaleDateString(undefined, { year: 'numeric', month: 'long', day: 'numeric' });
    const dateEl = document.getElementById('certDate');
    if (dateEl) dateEl.textContent = dateStr;
    const certId = generateCertificateId();
    const meta = document.getElementById('certMeta');
    const verifyUrl = `${window.location.origin}/verify?cert=${encodeURIComponent(certId)}`;
    if (meta) {
      // prepend text label and verify link before QR canvas
      const label = document.createElement('span');
      label.textContent = `ÿ±ŸÇŸÖ ÿßŸÑÿ¥ŸáÿßÿØÿ©: ${certId}`;
      const link = document.createElement('a');
      link.href = verifyUrl;
      link.target = '_blank';
      link.rel = 'noopener noreferrer';
      link.textContent = 'ÿßŸÑÿ™ÿ≠ŸÇŸÇ ÿπÿ®ÿ± ÿßŸÑÿ•ŸÜÿ™ÿ±ŸÜÿ™';
      link.style.marginLeft = '8px';
      meta.prepend(label);
      meta.prepend(link);
    }
    renderQr(verifyUrl);
    
  }

  function burstConfetti(count = 50) {
    const colors = [
      'var(--clown-red)', 'var(--clown-yellow)', 'var(--clown-green)', 'var(--clown-blue)', 'var(--clown-purple)'
    ];
    for (let i = 0; i < count; i++) {
      const piece = document.createElement('div');
      piece.className = 'confetti';
      piece.style.left = Math.random() * 100 + 'vw';
      piece.style.background = colors[Math.floor(Math.random() * colors.length)];
      piece.style.transform = `translateY(-20px) rotate(${Math.random()*360}deg)`;
      const duration = 2.4 + Math.random() * 1.6;
      piece.style.animationDuration = duration + 's';
      piece.style.opacity = (0.7 + Math.random()*0.3).toFixed(2);
      piece.style.width = (6 + Math.random()*8) + 'px';
      piece.style.height = (8 + Math.random()*12) + 'px';
      document.body.appendChild(piece);
      setTimeout(() => piece.remove(), duration * 1000);
    }
  }

  function renderCategoryStats() {
    const counters = { cool: { c: 0, t: 0, icon: 'üßä', label: 'ÿßŸÑÿ≥ŸÑÿ≥ŸÑÿ© ÿßŸÑÿ®ÿßÿ±ÿØÿ©' }, clean: { c: 0, t: 0, icon: 'üßº', label: 'ÿßŸÑŸÜÿ∏ÿßŸÅÿ©' }, transport: { c: 0, t: 0, icon: 'üöö', label: 'ÿßŸÑŸÜŸÇŸÑ' }, pack: { c: 0, t: 0, icon: 'ü•°', label: 'ÿßŸÑÿ™ÿπÿ®ÿ¶ÿ©' }, label: { c: 0, t: 0, icon: 'üè∑Ô∏è', label: 'ÿßŸÑÿ™Ÿàÿ≥ŸäŸÖ' } };
    quizzes.forEach((q, idx) => {
      const manual = normalizeType(q.category);
      const type = manual || detectType(q.question);
      const key = counters[type] ? type : null;
      if (!key) return;
      counters[key].t += 1;
      if (answeredCorrect[idx] === true) counters[key].c += 1;
    });
    const container = document.getElementById('categoryStats');
    const order = ['cool','clean','transport','pack','label'];
    const parts = order
      .filter(k => counters[k].t > 0)
      .map(k => {
        const { c, t, icon, label } = counters[k];
        return `<span style="display:inline-flex;align-items:center;gap:6px;margin:4px 8px;padding:6px 10px;border-radius:999px;background:#ffffffcc;border:1px solid #00000012">${icon} <strong>${label}</strong> <span style="opacity:.8">${c}/${t}</span></span>`;
      });
    container.innerHTML = parts.join('');
  }

  function generateCertificateId() {
    const rnd = Math.random().toString(36).slice(2, 8).toUpperCase();
    const ts = Date.now().toString(36).toUpperCase().slice(-6);
    return `${ts}-${rnd}`;
  }

  function renderQr(text) {
    try {
      const canvas = document.getElementById('certQr');
      if (!canvas || typeof QRious === 'undefined') return;
      new QRious({ element: canvas, value: text, size: 96, level: 'H', background: 'white', foreground: '#222' });
    } catch (_) {}
  }

  // Reset quiz flow
  document.addEventListener('click', (e) => {
    if (e.target && e.target.id === 'resetBtn') {
      resetQuiz();
    }
  });

  function resetQuiz() {
    current = 0;
    score = 0;
    answered = {};
    answeredCorrect = {};
    document.getElementById('certificate').style.display = 'none';
    document.getElementById('quizBox').style.display = 'block';
    document.body.classList.remove('certificate-mode');
    showQuestion();
    updateScore();
  }

  // Basic RTL auto-detect (Arabic locales)
  (function applyRTL() {
    try {
      const lang = (navigator.language || navigator.userLanguage || 'en').toLowerCase();
      if (lang.startsWith('ar')) {
        document.documentElement.setAttribute('dir', 'rtl');
      }
    } catch (_) {}
  })();
</script>
</body>
</html>


