<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>SafeFood Transport Quiz ‚Äì Food Business Edition</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Merriweather:wght@700&display=swap" rel="stylesheet">
<script src="https://unpkg.com/qrious@4.0.2/dist/qrious.min.js"></script>
<style>
  :root {
    --primary: #2E7D32;
    --secondary: #2F3A3B;
    --accent: #AF9961;
    --muted: #ECEFF1;
    --ink: #253033;
    --ink-soft: #4a5b60;
    --paper: #ffffff;
    --success-bg: #E8F5E9;
    --danger-bg: #FDECEA;
    --success-border: #A5D6A7;
    --danger-border: #FFCDD2;
  }

  html, body { height: 100%; margin: 0; padding-bottom: 120px; font-family: 'Cairo', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; background: rgb(238, 234, 224); font-size: 140%; }

  header {
    background: linear-gradient(90deg, var(--secondary), var(--primary));
    color: white;
    padding: 0.75rem 1.25rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky;
    top: 0;
    z-index: 5;
    box-shadow: 0 2px 8px rgba(0,0,0,0.12);
  }
  header img { height: 56px; }
  header h1 {
    flex-grow: 1;
    text-align: center;
    margin: 0;
    font-family: 'Cairo', sans-serif;
    font-size: 50px;
    letter-spacing: .5px;
  }

  /* Progress bar styles */
  #progressContainer {
    width: 100%;
    background: #eee;
    height: 8px;
    border-radius: 4px;
    margin: 1rem 0;
  }
  #progressBar {
    height: 100%;
    background: var(--primary);
    width: 0%;
    border-radius: 4px;
    transition: width 0.3s;
  }

  .container {
    max-width: 820px;
    margin: 2rem auto;
    padding: 1.25rem;
    background: var(--paper);
    border-radius: 16px;
    box-shadow: 0 1px 0 #00000005, 0 6px 14px rgba(0,0,0,0.06);
    border: 1px solid #E0E6EA;
  }

  /* Question style */
  .question {
    font-family: 'Cairo', sans-serif;
    font-size: 36px;
    color: #1e1e1e;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 10px;
    opacity: 1;
    transition: opacity 0.5s, transform 0.5s;
  }
  /* Animate question fade/slide */
  .question.fade-out {
    opacity: 0;
    transform: translateY(-20px);
  }
  .question.fade-in {
    opacity: 1;
    transform: translateY(0);
  }

  .qicon { display:none; }
  .qicon.cool { color: #1e88e5; }
  .qicon.clean { color: #00acc1; }
  .qicon.transport { color: #43A047; }
  .qicon.pack { color: #8D6E63; }
  .qicon.label { color: #F57C00; }

  .qbadge {
    display: inline-block;
    margin-right: 8px;
    padding: 4px 10px;
    border-radius: 999px;
    font-family: 'Cairo', sans-serif;
    font-weight: 600;
    font-size: 0.65em;
    vertical-align: middle;
    border: 2px solid #00000012;
    background: #fff;
  }
  .qbadge.cool { background: #bbdefb; color: #0d47a1; }
  .qbadge.clean { background: #b2ebf2; color: #006064; }
  .qbadge.transport { background: #c8e6c9; color: #1b5e20; }
  .qbadge.pack { background: #e1bee7; color: #4a148c; }
  .qbadge.label { background: #ffe0b2; color: #e65100; }

  .options { list-style: none; padding: 0; margin: 0; }
  .options li {
    position: relative;
    background: #ffffff;
    margin: 0.65rem 0;
    padding: 0.9rem 1.1rem;
    border-radius: 14px;
    cursor: pointer;
    font-size: 1em;
    transition: transform 0.12s ease, box-shadow 0.2s ease;
    box-shadow: 0 2px 0 #00000010, 0 10px 18px rgba(0,0,0,0.06);
  }
  .options li:hover { transform: translateY(-1px); box-shadow: 0 6px 18px rgba(0,0,0,0.10); }
  .options li.correct {
    background: var(--success-bg);
    border-color: var(--success-border);
    color: var(--primary-600);
  }
  .options li.incorrect {
    background: var(--danger-bg);
    border-color: var(--danger-border);
  }

  #score {
    margin-top: 1rem;
    font-weight: 700;
    color: #1d3b2f;
    text-align: center;
    background: linear-gradient(90deg, #fff, #f9f9f9);
    border-radius: 10px;
    padding: 8px 12px;
    border: 2px solid #e8e8e8;
    display: inline-block;
    min-width: 220px;
    font-size: 1em;
  }

  /* Certificate as image container */
  #certificate {
    display: none;
    text-align: center;
    padding: 2rem 1.2rem 3rem;
  }
  #certificate .card {
    margin: 0 auto;
    max-width: 1000px;
    background: #ffffff;
    border-radius: 12px;
    padding: 2rem 2.5rem;
    border: 1px solid #D8DFE3;
    box-shadow: 0 12px 30px rgba(0,0,0,0.08);
    position: relative;
  }
  #certificate h2 {
    color: var(--secondary);
    font-size: 34px;
    font-family: 'Merriweather', serif;
    letter-spacing: .5px;
    margin-bottom: 0.5rem;
  }
  #certificate img {
    max-width: 100%;
    height: auto;
  }
  #certificate button {
    margin-top: 1rem;
    background: var(--primary);
    color: #fff;
    border: none;
    padding: 0.65rem 1.25rem;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 700;
    box-shadow: 0 8px 16px rgba(0,0,0,0.12);
  }

  /* Certificate footer styles */
  .cert-footer {
    display: flex;
    justify-content: space-between;
    gap: 24px;
    margin-top: 28px;
    padding-top: 16px;
    border-top: 1px solid #E0E6EA;
  }
  .sig-block {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
  }
  .sig-text {
    color: var(--secondary);
    font-weight: 600;
    margin-bottom: 10px;
  }
  .sig-line {
    height: 1px;
    background: #B0BEC5;
    margin-top: 18px;
  }
  .sig-label {
    color: var(--ink-soft);
    font-size: 0.85em;
    margin-top: 6px;
  }

  /* Navigation buttons */
  .nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: #fff;
    padding: 0.75rem;
    text-align: center;
    z-index: 10;
    box-shadow: 0 -6px 16px rgba(0,0,0,0.06);
  }
  .nav button {
    background: #fff;
    color: #2E4A3B;
    border: 3px solid #00000014;
    padding: 0.6rem 1.1rem;
    margin: 0 0.4rem;
    border-radius: 14px;
    cursor: pointer;
    font-weight: 900;
    font-family: 'Cairo', sans-serif;
    font-size: 1em;
    box-shadow: 0 3px 0 #00000010, 0 10px 16px rgba(0,0,0,0.08);
  }
  .nav button:hover { transform: translateY(-1px); }

  /* Modal styles */
  .modal {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #fff;
    border: 1px solid #E0E6EA;
    border-radius: 12px;
    padding: 1rem;
    max-width: 460px;
    width: 90%;
    box-shadow: 0 12px 24px rgba(0,0,0,0.12);
    z-index: 200;
    text-align: center;
  }
  .modal h3 { margin-top: 0; color: var(--secondary); font-family: 'Cairo', sans-serif; font-size: 28px; }
  .modal button {
    margin-top: 0.75rem;
    background: var(--primary);
    color: #fff;
    border: none;
    padding: 0.55rem 1.1rem;
    border-radius: 12px;
    cursor: pointer;
    font-weight: 700;
  }

  /* Confetti styles */
  .confetti {
    position: fixed;
    top: 0;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    opacity: 0.8;
    pointer-events: none;
    z-index: 1000;
    animation: fall 2s forwards;
  }
  @keyframes fall {
    to {
      transform: translateY(100vh) rotate(720deg);
      opacity: 0;
    }
  }
</style>
<!-- Sound effects -->
<audio id="correctSound" src="https://www.soundjay.com/buttons/sounds/button-3.mp3" preload="auto"></audio>
<audio id="incorrectSound" src="https://www.soundjay.com/buttons/sounds/button-10.mp3" preload="auto"></audio>
<audio id="celebrationSound" src="https://www.soundjay.com/human/sounds/applause-8.mp3" preload="auto"></audio>
</head>
<body>
<header>
  <img src="logo-left.png" alt="Left Logo" />
  <h1>SafeFood Transport Training ‚Äì Food Business Edition</h1>
  <img src="logo-right.png" alt="Right Logo" />
</header>

<!-- Progress Bar -->
<div id="progressContainer">
  <div id="progressBar"></div>
</div>

<div class="container" id="quizBox">
  <div class="question" id="question"></div>
  <ul class="options" id="options"></ul>
  <div style="text-align:center"><div id="score">üìä Score: 0 / 0</div></div>
</div>

<!-- Final Certificate as Image -->
<div id="certificate">
  <div class="card">
    <h2 style="text-align:center;">üéì Certificate of Completion üéì</h2>
    <p style="text-align:center;">This certifies that <strong id="userName">Mohammed</strong> has successfully completed</p>
    <p style="text-align:center;"><em>SafeFood Transport Safety Training</em></p>
    <p style="text-align:center;">Final Score: <strong id="finalScore">0/0</strong></p>
    <div id="categoryStats" style="margin-top:12px"></div>
    <img id="certImage" src="" alt="Certificate Image" style="margin-top:20px; max-width:100%; height:auto; display:none;"/>
    <div style="margin-top:12px; display:flex; gap:12px; justify-content:center; align-items:center; flex-wrap:wrap">
      <button onclick="window.print()">üñ®Ô∏è Print Your Certificate</button>
      <button id="resetBtn" style="background:#fff;color:#2F3A3B;border:1px solid #CBD5E1;">‚Ü∫ Reset Quiz</button>
    </div>
  </div>
</div>

<div class="nav">
  <button onclick="prevQuestion()">‚¨ÖÔ∏è Previous</button>
  <button onclick="nextQuestion()">‚û°Ô∏è Next</button>
</div>

<div class="modal" id="feedbackModal">
  <h3>üí° Tip</h3>
  <p id="modalContent"></p>
  <button onclick="closeModal()">Continue</button>
</div>

<script>
  let quizzes = [];
  let current = 0;
  let score = 0;
  let answered = {};
  let answeredCorrect = {};

  // Fallback quizzes
  function seedFallbackQuizzes() {
    return [
      {
        id: 1,
        question: 'What is the safest temperature for transporting perishable food?',
        options: ['0-5¬∞C', '10-15¬∞C', '20-25¬∞C', 'Any temperature'],
        answer: 0,
        category: 'cool',
        explanation: 'Cold chain food should generally be kept at 0-5¬∞C to prevent bacterial growth.'
      },
      {
        id: 2,
        question: 'Which practice reduces cross-contamination during transport?',
        options: ['Mix raw and cooked foods', 'Separate sealed containers', 'No labels needed', 'Use same tools'],
        answer: 1,
        category: 'clean',
        explanation: 'Separate sealed containers and labeling help avoid cross-contamination.'
      },
      {
        id: 3,
        question: 'What should be done before loading food?',
        options: ['Ignore vehicle cleanliness', 'Sanitize vehicle surfaces', 'Turn off refrigeration', 'Skip checks'],
        answer: 1,
        category: 'transport',
        explanation: 'Sanitizing reduces contamination risk; ensure refrigeration is functional before loading.'
      }
    ];
  }

  // Fetch quizzes or fallback
  fetch('quizzes.json')
    .then(res => res.ok ? res.json() : Promise.reject())
    .then(data => {
      quizzes = data.quizzes || seedFallbackQuizzes();
      showQuestion();
      updateScore();
    })
    .catch(() => {
      quizzes = seedFallbackQuizzes();
      showQuestion();
      updateScore();
    });

  // Update progress bar
  function updateProgress() {
    const percent = ((current+1) / quizzes.length) * 100;
    document.getElementById('progressBar').style.width = percent + '%';
  }

  // Show question with animation
  function showQuestion() {
    const q = quizzes[current];
    if (!q) return;
    const qEl = document.getElementById('question');
    qEl.classList.add('fade-out');
    setTimeout(() => {
      // Update question text
      const type = normalizeType(q.category) || detectType(q.question);
      const badge = type ? `<span class="qbadge ${type}">${type}</span>` : '';
      qEl.innerHTML = `${badge} Q${q.id}: ${q.question}`;
      qEl.classList.remove('fade-out');
      qEl.classList.add('fade-in');
    }, 300);
    setTimeout(() => {
      qEl.classList.remove('fade-in');
    }, 800);

    // Theme class
    const box = document.getElementById('quizBox');
    box.className = '';
    if (type) box.classList.add(`qtheme-${type}`);
    // Clear options
    const optionsList = document.getElementById('options');
    optionsList.innerHTML = '';
    // Populate options
    q.options.forEach((opt, i) => {
      const li = document.createElement('li');
      li.textContent = opt;
      li.onclick = () => {
        if (answered[current]) return;
        answered[current] = true;
        if (i === q.answer) {
          li.classList.add('correct');
          score++;
          answeredCorrect[current] = true;
          document.getElementById('correctSound').play();
          burstConfetti(30);
        } else {
          li.classList.add('incorrect');
          if (optionsList.children[q.answer]) {
            optionsList.children[q.answer].classList.add('correct');
          }
          answeredCorrect[current] = false;
          document.getElementById('incorrectSound').play();
        }
        updateScore();
        // Show tip modal
        document.getElementById('modalContent').textContent = `‚úÖ Correct answer: ${q.options[q.answer]}\nüí¨ ${q.explanation}`;
        document.getElementById('feedbackModal').style.display = 'block';

        // Celebration if last question answered
        if (current === quizzes.length -1 && answered[current]) {
          setTimeout(() => {
            document.getElementById('celebrationSound').play();
            burstConfetti(100);
          }, 200);
        }
      };
      optionsList.appendChild(li);
    });
    updateProgress();
  }

  // Detect question type based on text
  function detectType(text) {
    const t = (text || '').toLowerCase();
    if (/(temp|cold|chill|cool|¬∞|c|cold chain|freeze|refriger)/.test(t)) return 'cool';
    if (/(sanitize|clean|hygiene|wash|disinfect|cleanliness)/.test(t)) return 'clean';
    if (/(transport|truck|deliver|vehicle|load|unload|route)/.test(t)) return 'transport';
    if (/(pack|seal|container|package|wrap|box)/.test(t)) return 'pack';
    if (/(label|expiry|date|trace|tag)/.test(t)) return 'label';
    return '';
  }

  function normalizeType(category) {
    if (!category) return '';
    const t = String(category).toLowerCase().trim();
    if (/^(temp|cold|cool|chill|freeze|refriger|temperature|cold\s*chain)$/.test(t)) return 'cool';
    if (/^(clean|cleaning|hygiene|wash|sanitize|sanitization|disinfect)$/.test(t)) return 'clean';
    if (/^(transport|delivery|vehicle|logistics|route|loading)$/.test(t)) return 'transport';
    if (/^(pack|packaging|seal|container|boxing|wrapping)$/.test(t)) return 'pack';
    if (/^(label|labelling|labeling|expiry|expiration|trace|traceability|tag)$/.test(t)) return 'label';
    return '';
  }

  // Reset quiz
  document.getElementById('resetBtn').onclick = resetQuiz;
  function resetQuiz() {
    current = 0;
    score = 0;
    answered = {};
    answeredCorrect = {};
    document.getElementById('certificate').style.display = 'none';
    document.getElementById('quizBox').style.display = 'block';
    document.body.className = '';
    showQuestion();
    updateScore();
  }

  // Next question
function nextQuestion() {
  const modal = document.getElementById('feedbackModal');
  if (modal.style.display === 'block') return;
  if (current < quizzes.length -1) {
    current++;
    showQuestion();
  } else if (answered[current]) {
    showCertificate();
  }
}

// Previous question
function prevQuestion() {
  if (current > 0) {
    current--;
    showQuestion();
  }
}

// Update score display
function updateScore() {
  document.getElementById('score').textContent = `üìä Score: ${score} / ${quizzes.length}`;
}

// Show final certificate as image
function showCertificate() {
  document.getElementById('quizBox').style.display = 'none';
  document.getElementById('finalScore').textContent = `${score} / ${quizzes.length}`;
  document.getElementById('certificate').style.display = 'block';

  // Generate a simple "certificate" image
  const canvas = document.createElement('canvas');
  canvas.width = 800; canvas.height= 600;
  const ctx = canvas.getContext('2d');
  ctx.fillStyle="#fff"; ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.font="40px Merriweather";
  ctx.fillStyle="#2f3a3b";
  ctx.textAlign = "center";
  ctx.fillText("üéâ Certificate of Completion üéâ", 400, 100);
  ctx.font="24px Merriweather";
  ctx.fillText(`This certifies that`, 400, 150);
  ctx.font="30px Merriweather";
  ctx.fillText(`Mohammed`, 400, 200);
  ctx.font="24px Merriweather";
  ctx.fillText(`has successfully completed`, 400, 250);
  ctx.font="28px Merriweather";
  ctx.fillText(`SafeFood Transport Safety Training`, 400, 300);
  ctx.font="24px Merriweather";
  ctx.fillText(`Final Score: ${score} / ${quizzes.length}`, 400, 350);
  ctx.font="20px Merriweather";
  ctx.fillText(`Date: ${(new Date()).toLocaleDateString()}`, 400, 400);
  // convert canvas to image
  const dataUrl = canvas.toDataURL("image/png");
  const img = document.getElementById('certImage');
  img.src = dataUrl;
  img.style.display='block';

  // Burst confetti
  burstConfetti(150);
  document.getElementById('celebrationSound').play();
}

// Confetti burst
function burstConfetti(count=50) {
  const colors=['#FF6F61','#6B5B95','#88B04B','#F7CAC9','#92A8D1','#955251','#B565A7'];
  for (let i=0; i<count; i++) {
    const c = document.createElement('div');
    c.className='confetti';
    c.style.left=Math.random()*100+'vw';
    c.style.background=colors[Math.floor(Math.random()*colors.length)];
    c.style.width=c.style.height=(4+Math.random()*4)+'px';
    c.style.transform=`translateY(-20px) rotate(${Math.random()*360}deg)`;
    document.body.appendChild(c);
    setTimeout(()=>c.remove(),2000);
  }
}

// Show category stats
function renderCategoryStats() {
  const counters = {
    cool: { c:0, t:0, icon:'üßä', label:'Cold Chain' },
    clean: { c:0, t:0, icon:'üßº', label:'Hygiene' },
    transport: { c:0, t:0, icon:'üöö', label:'Transport' },
    pack: { c:0, t:0, icon:'ü•°', label:'Packaging' },
    label: { c:0, t:0, icon:'üè∑Ô∏è', label:'Labelling' }
  };
  quizzes.forEach((q, idx) => {
    const type = normalizeType(q.category) || detectType(q.question);
    if (type && counters[type]) {
      counters[type].t += 1;
      if (answeredCorrect[idx]) counters[type].c +=1;
    }
  });
  const container = document.getElementById('categoryStats');
  const order = ['cool','clean','transport','pack','label'];
  const parts = order
    .filter(k => counters[k].t > 0)
    .map(k => {
      const { c, t, icon, label } = counters[k];
      return `<span style="display:inline-flex;align-items:center;gap:6px;margin:4px 8px;padding:6px 10px;border-radius:999px;background:#ffffffcc;border:1px solid #00000012">${icon} <strong>${label}</strong> <span style="opacity:.8">${c}/${t}</span></span>`;
    });
  container.innerHTML=parts.join('');
}

function normalizeType(category) {
  if (!category) return '';
  const t = String(category).toLowerCase().trim();
  if (/^(temp|cold|cool|chill|freeze|refriger|temperature|cold\s*chain)$/.test(t)) return 'cool';
  if (/^(clean|cleaning|hygiene|wash|sanitize|sanitization|disinfect)$/.test(t)) return 'clean';
  if (/^(transport|delivery|vehicle|logistics|route|loading)$/.test(t)) return 'transport';
  if (/^(pack|packaging|seal|container|boxing|wrapping)$/.test(t)) return 'pack';
  if (/^(label|labelling|labeling|expiry|expiration|trace|traceability|tag)$/.test(t)) return 'label';
  return '';
}

function detectType(text) {
  const t = (text||'').toLowerCase();
  if (/(temp|cold|chill|cool|¬∞|c|cold chain|freeze|refriger)/.test(t)) return 'cool';
  if (/(sanitize|clean|hygiene|wash|disinfect|sanitize|cleanliness)/.test(t)) return 'clean';
  if (/(transport|truck|deliver|vehicle|load|unload|route)/.test(t)) return 'transport';
  if (/(pack|seal|container|package|wrap|box)/.test(t)) return 'pack';
  if (/(label|expiry|date|trace|tag)/.test(t)) return 'label';
  return '';
}

// Initialize first question
showQuestion();

// RTL support
(function applyRTL() {
  try {
    const lang = (navigator.language || navigator.userLanguage || 'en').toLowerCase();
    if (lang.startsWith('ar')) {
      document.documentElement.setAttribute('dir', 'rtl');
    }
  } catch (_) {}
})();
</script>
</body>
</html>
