<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üöõ Food Safety Adventure ‚Äì Transport Edition</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/qrious@4.0.2/dist/qrious.min.js"></script>
  <style>
    :root {
      /* Light brown and silver/white modern color palette */
      --primary: #D2B48C; /* light brown/tan */
      --primary-600: #C19A6B; /* slightly darker light brown */
      --secondary: #E6D7C3; /* very light brown */
      --accent: #F5F5F5; /* very light silver */
      --muted: #FAFAFA; /* very light gray/white */
      --ink: #4A4A4A; /* soft dark gray instead of dark brown */
      --ink-soft: #8A8A8A; /* light gray */
      --paper: #FFFFFF; /* pure white */
      --success-bg: #F0FDF4; /* green-50 */
      --danger-bg: #FEF2F2; /* red-50 */
      --success-border: #22C55E; /* green-500 */
      --danger-border: #EF4444; /* red-500 */
      --header-bg: transparent;
      --footer-bg: #C19A6B; /* light brown */
      --green-light: #86EFAC; /* green-300 */
      --green-medium: #22C55E; /* green-500 */
      --green-dark: #15803D; /* green-700 */
      --yellow-bg: #FEF3C7; /* yellow-100 */
      --yellow-border: #F59E0B; /* yellow-500 */
      --border-color: #E5E5E5; /* very light silver */
      --hover-bg: #F8F8F8; /* very light gray */
    }

    * {
      box-sizing: border-box;
    }

    html, body { 
      height: 100%; 
      margin: 0;
      padding: 0;
    }
    
    html { 
      font-size: 14px; /* Base font size for better readability */
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      color: var(--ink);
      background: var(--muted); /* Simple, clean background */
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      line-height: 1.7;
      font-weight: 400;
    }

    header {
      background: var(--paper);
      color: var(--ink);
      padding: 1rem 1.5rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      /* Removed border-bottom line */
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      flex-shrink: 0;
    }
    
    header img { 
      height: 40px;
      object-fit: contain;
    }
    
    header h1 {
      flex-grow: 1;
      text-align: center;
      margin: 0;
      font-family: 'Inter', sans-serif;
      font-size: 1.8rem; /* Increased by 20% from 1.5rem */
      font-weight: 600;
      color: var(--ink);
    }
    
    /* Top section with combined levels and score */
    .top-section {
      background: var(--paper);
      padding: 1rem 1.5rem;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1rem;
    }

    /* Combined levels and score container */
    .levels-score-container {
      display: flex;
      align-items: center;
      gap: 1rem;
      flex: 1;
    }

    .main-content {
      flex: 1;
      display: flex;
      padding: 1.5rem;
      max-width: 1200px;
      margin: 0 auto;
      width: 100%;
      gap: 1.5rem;
    }

    /* Left side - Educational content */
    .left-panel {
      flex: 1;
      min-width: 300px;
    }

    /* Right side - Quiz content */
    .right-panel {
      flex: 2;
      min-width: 400px;
    }

    .container {
      background: var(--paper);
      border-radius: 8px;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
      border: 0.5px solid var(--border-color); /* Reduced by 80% from 1px */
      padding: 1.25rem;
      position: relative;
      overflow: hidden;
      height: fit-content;
      min-height: fit-content;
    }
    
    .container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--primary), var(--secondary), var(--green-medium));
    }

    /* Theme variations with brown/green colors */
    #quizBox.qtheme-cool { 
      border-left: 4px solid var(--green-medium);
    }
    #quizBox.qtheme-clean { 
      border-left: 4px solid var(--secondary);
    }
    #quizBox.qtheme-transport { 
      border-left: 4px solid var(--primary);
    }
    #quizBox.qtheme-pack { 
      border-left: 4px solid var(--accent);
    }
    #quizBox.qtheme-label { 
      border-left: 4px solid var(--ink-soft);
    }

    .question {
      font-family: 'Inter', sans-serif;
      font-size: 1.4rem; /* Increased for better readability */
      font-weight: 600; /* Increased weight for better visibility */
      color: var(--ink);
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      line-height: 1.6;
      padding: 1rem;
      background: var(--muted);
      border-radius: 6px;
      border: 0.5px solid var(--border-color); /* Reduced by 80% from 1px */
    }

    .qbadge {
      display: inline-block;
      margin-right: 0.5rem;
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-family: 'Inter', sans-serif;
      font-weight: 500;
      font-size: 1.35rem; /* Increased by 80% from 0.75rem */
      vertical-align: middle;
      border: 0.5px solid var(--border-color); /* Reduced by 80% from 1px */
      background: var(--paper);
      color: var(--ink-soft);
    }

    .qbadge.cool { 
      background: var(--success-bg); 
      color: var(--green-dark); 
      border-color: var(--green-medium);
    }
    .qbadge.clean { 
      background: var(--muted); 
      color: var(--primary); 
      border-color: var(--secondary);
    }
    .qbadge.transport { 
      background: var(--success-bg); 
      color: var(--green-dark); 
      border-color: var(--green-medium);
    }
    .qbadge.pack { 
      background: var(--hover-bg); 
      color: var(--primary); 
      border-color: var(--accent);
    }
    .qbadge.label { 
      background: var(--hover-bg); 
      color: var(--ink-soft); 
      border-color: var(--border-color);
    }

    .options { 
      list-style: none; 
      padding: 0; 
      margin: 0; 
    }
    
    .options li {
      position: relative;
      background: var(--paper);
      margin: 0.75rem 0;
      padding: 1rem 1.25rem;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1.15rem; /* Increased for better readability */
      font-family: 'Inter', sans-serif;
      font-weight: 500; /* Increased weight for better visibility */
      transition: all 0.2s ease;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
      border: 0.5px solid var(--border-color); /* Reduced by 80% from 1px */
      transform: translateY(0);
      line-height: 1.6;
    }
    
    .options li:hover { 
      transform: translateY(-1px); 
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      border-color: var(--primary);
      background: var(--hover-bg);
    }
    
    .options li.correct {
      background: var(--success-bg);
      border-color: var(--success-border);
      color: var(--green-dark);
      transform: scale(1.02);
      box-shadow: 0 4px 12px rgba(34, 197, 94, 0.2);
    }
    
    .options li.correct::before {
      content: '‚úÖ';
      font-size: 1.25rem;
      font-weight: 600;
      margin-right: 0.5rem;
      color: var(--success-border);
    }
    
    .options li.incorrect {
      background: var(--danger-bg);
      border-color: var(--danger-border);
      color: #DC2626;
      transform: scale(0.98);
      opacity: 0.8;
    }
    
    .options li.incorrect::before {
      content: '‚ùå';
      font-size: 1.25rem;
      font-weight: 600;
      margin-right: 0.5rem;
      color: var(--danger-border);
    }

    #score {
      font-weight: 600;
      color: var(--ink);
      background: var(--paper);
      border-radius: 6px;
      padding: 0.5rem 0.75rem;
      border: 0.5px solid var(--border-color); /* Reduced by 80% from 1px */
      font-size: 1rem;
      white-space: nowrap;
      width: fit-content;
      min-width: fit-content;
    }

    #certificate {
      display: none;
      text-align: center;
      padding: 2rem 1rem;
    }
    
    #certificate .card {
      margin: 0 auto;
      max-width: 800px;
      background: var(--paper);
      border-radius: 12px;
      padding: 2rem;
      border: 0.5px solid var(--border-color); /* Reduced by 80% from 1px */
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      position: relative;
    }
    
    #certificate h2 {
      color: var(--ink);
      font-size: 2rem;
      font-family: 'Inter', serif;
      font-weight: 600;
      margin-bottom: 1rem;
    }
    
    #certificate button {
      margin-top: 1rem;
      background: var(--primary);
      color: var(--paper);
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
      font-family: 'Inter', sans-serif;
      transition: background-color 0.2s ease;
    }
    
    #certificate button:hover {
      background: var(--primary-600);
    }

    /* Certificate footer */
    .cert-footer {
      display: flex;
      justify-content: space-between;
      gap: 2rem;
      margin-top: 2rem;
      padding-top: 1rem;
      border-top: 1px solid var(--border-color);
    }
    
    .sig-block {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
    }
    
    .sig-text {
      color: var(--ink);
      font-weight: 500;
      margin-bottom: 0.5rem;
    }
    
    .sig-line {
      height: 1px;
      background: var(--border-color);
      margin-top: 1rem;
    }
    
    .sig-label {
      color: var(--ink-soft);
      font-size: 0.875rem;
      margin-top: 0.5rem;
    }

    footer {
      background: transparent; /* No background */
      color: var(--ink-soft);
      padding: 1rem;
      text-align: center;
      flex-shrink: 0;
      border-top: 1px solid var(--border-color);
    }
    
    footer p {
      margin: 0;
      font-size: 0.875rem;
      font-family: 'Inter', sans-serif;
      font-weight: 400;
    }

    .nav {
      background: var(--paper);
      padding: 1rem;
      text-align: center;
      border-top: 1px solid var(--border-color);
      margin-top: 1.5rem;
    }
    
    .nav button {
      background: var(--paper);
      color: var(--ink);
      border: 0.5px solid var(--border-color); /* Reduced by 80% from 1px */
      padding: 0.75rem 1.25rem;
      margin: 0 0.5rem;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
      font-family: 'Inter', sans-serif;
      font-size: 0.875rem;
      transition: all 0.2s ease;
    }
    
    .nav button:hover { 
      background: var(--hover-bg);
      border-color: var(--primary);
    }
    
    .nav button:active { 
      transform: translateY(1px); 
    }

    .modal {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--paper);
      border: 0.5px solid var(--border-color); /* Reduced by 80% from 1px */
      border-radius: 12px;
      padding: 2rem;
      max-width: 500px;
      width: 90%;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
      z-index: 200;
      text-align: center;
    }
    
    .modal h3 { 
      margin-top: 0; 
      color: var(--ink); 
      font-family: 'Inter', sans-serif; 
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 1rem;
    }
    
    .modal p {
      font-size: 1rem;
      line-height: 1.6;
      margin-bottom: 1.5rem;
      color: var(--ink-soft);
    }
    
    .modal button {
      background: var(--primary);
      color: var(--paper);
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
      font-size: 1rem;
      font-family: 'Inter', sans-serif;
      transition: background-color 0.2s ease;
    }
    
    .modal button:hover {
      background: var(--primary-600);
    }

    /* Levels box - now inline with score */
    .levels-box {
      background: var(--paper);
      border: 0.5px solid var(--border-color); /* Reduced by 80% from 1px */
      border-radius: 6px;
      padding: 0.5rem 0.75rem;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
      flex: 1;
      width: fit-content;
      min-width: fit-content;
    }
    
    .levels-header {
      font-family: 'Inter', sans-serif;
      font-size: 0.9rem;
      font-weight: 700;
      color: var(--ink);
      margin-bottom: 0.5rem;
    }
    
    .levels-list {
      display: flex;
      flex-wrap: wrap;
      gap: 0.25rem;
    }
    
    .level-item {
      border-radius: 4px;
      padding: 0.3rem 0.6rem;
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--ink);
      cursor: pointer;
      transition: all 0.2s ease;
      border: 0.5px solid var(--border-color); /* Reduced by 80% from 1px */
    }
    
    /* Green for correct answers */
    .level-item.correct {
      background: var(--success-bg);
      border-color: var(--success-border);
      color: var(--green-dark);
    }
    
    /* Yellow for incorrect answers */
    .level-item.incorrect {
      background: var(--yellow-bg);
      border-color: var(--yellow-border);
      color: #92400E;
    }
    
    /* Default state */
    .level-item {
      background: var(--hover-bg);
    }
    
    .level-item:hover {
      background: var(--primary);
      color: var(--paper);
      border-color: var(--primary);
    }
    
    .level-item.active {
      background: var(--primary);
      color: var(--paper);
      border-color: var(--primary);
    }

    /* Educational Content */
    .edu-content {
      background: var(--muted);
      border: 0.5px solid var(--border-color); /* Reduced by 80% from 1px */
      border-radius: 6px;
      padding: 0.75rem;
      position: relative;
      height: fit-content;
      min-height: fit-content;
    }
    
    .edu-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 1rem;
      font-family: 'Inter', sans-serif;
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--ink);
    }
    
    .edu-tabs {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }
    
    .edu-tab {
      padding: 0.5rem 1rem;
      background: var(--paper);
      border: 0.5px solid var(--border-color); /* Reduced by 80% from 1px */
      border-radius: 6px;
      cursor: pointer;
      font-family: 'Inter', sans-serif;
      font-weight: 500;
      transition: all 0.2s ease;
      font-size: 0.875rem;
    }
    
    .edu-tab.active {
      background: var(--primary);
      color: var(--paper);
      border-color: var(--primary);
    }
    
    .edu-tab:hover {
      background: var(--hover-bg);
      border-color: var(--primary);
    }
    
    .edu-content-area {
      min-height: 120px;
      background: var(--paper);
      border-radius: 6px;
      padding: 0.75rem;
      border: 0.5px solid var(--border-color); /* Reduced by 80% from 1px */
      height: fit-content;
    }
    
    .video-placeholder {
      background: linear-gradient(135deg, var(--primary), var(--primary-600));
      border-radius: 8px;
      height: 120px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--paper);
      font-family: 'Inter', sans-serif;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
      overflow: hidden;
    }
    
    .video-placeholder::before {
      content: '‚ñ∂';
      font-size: 2rem;
      margin-right: 0.5rem;
    }
    
    .video-placeholder:hover {
      transform: scale(1.02);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
    
    .infographic-content {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
    }
    
    .info-card {
      background: var(--hover-bg);
      border: 0.5px solid var(--border-color); /* Reduced by 80% from 1px */
      border-radius: 8px;
      padding: 1rem;
      text-align: center;
      transition: all 0.2s ease;
    }
    
    .info-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      border-color: var(--primary);
    }
    
    .info-icon {
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }
    
    .info-title {
      font-family: 'Inter', sans-serif;
      font-weight: 600;
      color: var(--ink);
      margin-bottom: 0.5rem;
    }
    
    .info-desc {
      font-family: 'Inter', sans-serif;
      font-size: 0.875rem;
      color: var(--ink-soft);
      line-height: 1.4;
    }

    /* Auto-advance feature */
    .auto-advance {
      background: var(--success-bg);
      border: 0.5px solid var(--success-border); /* Reduced by 80% from 1px */
      border-radius: 8px;
      padding: 1rem;
      margin: 1rem 0;
      text-align: center;
      font-family: 'Inter', sans-serif;
      font-weight: 500;
      color: var(--green-dark);
    }
    
    .countdown {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--green-dark);
      margin: 0.5rem 0;
    }

    /* Progress bar */
    .progress-container {
      background: var(--hover-bg);
      border-radius: 4px;
      height: 6px;
      margin: 1rem 0;
      overflow: hidden;
    }
    
    .progress-bar {
      background: linear-gradient(90deg, var(--primary), var(--green-medium));
      height: 100%;
      width: 0%;
      transition: width 0.5s ease;
      border-radius: 4px;
    }

    /* Animations */
    @keyframes slideInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes celebrate {
      0% { transform: scale(1) rotate(0deg); }
      25% { transform: scale(1.1) rotate(-5deg); }
      50% { transform: scale(1.2) rotate(5deg); }
      75% { transform: scale(1.1) rotate(-2deg); }
      100% { transform: scale(1.05) rotate(0deg); }
    }
    
    @keyframes confetti {
      0% { transform: translateY(0) rotate(0deg); opacity: 1; }
      100% { transform: translateY(-100px) rotate(360deg); opacity: 0; }
    }
    
    .slide-in {
      animation: slideInUp 0.4s ease-out;
    }
    
    .celebrate {
      animation: celebrate 0.6s ease-in-out;
    }
    
    .confetti {
      position: absolute;
      font-size: 1.5rem;
      pointer-events: none;
      animation: confetti 1s ease-out forwards;
    }

    /* Responsive design */
    @media (max-width: 768px) {
      .main-content {
        flex-direction: column;
        padding: 1rem;
      }
      
      .top-section {
        flex-direction: column;
        gap: 0.5rem;
      }
      
      .levels-score-container {
        flex-direction: column;
        width: 100%;
      }
      
      header {
        padding: 0.75rem 1rem;
      }
      
      header h1 {
        font-size: 1.5rem;
      }
      
      .question {
        font-size: 1.2rem;
        padding: 0.75rem;
      }
      
      .options li {
        padding: 0.75rem 1rem;
      }
      
      .cert-footer {
        flex-direction: column;
        gap: 1rem;
      }
    }

    /* Print styles */
    @media print {
      @page { 
        size: A4 landscape; 
        margin: 15mm; 
      }
      
      body { 
        background: white !important; 
      }
      
      header { 
        box-shadow: none; 
      }
      
      .nav, #score { 
        display: none !important; 
      }
      
      #certificate { 
        display: block !important; 
      }
      
      #quizBox, .modal { 
        display: none !important; 
      }
      
      #certificate .card { 
        max-width: 100%; 
        box-shadow: none; 
        border-width: 2px; 
      }
    }
  </style>
</head>
<body>
<header>
  <img src="logo-left.png" alt="Left Logo" />
  <h1>üöõ Food Safety Adventure ‚Äì Transport Edition</h1>
  <img src="logo-right.png" alt="Right Logo" />
</header>

<!-- Top section with combined levels and score -->
<div class="top-section">
  <div class="levels-score-container">
    <!-- Levels Box -->
    <div class="levels-box" id="levelsBox">
      <div class="levels-header">üéØ Training Levels</div>
      <div class="levels-list" id="levelsList">
        <!-- Levels will be loaded dynamically -->
      </div>
    </div>
    
    <!-- Score display -->
    <div id="score">üìä Score: 0 / 0</div>
  </div>
</div>

<div class="main-content">
  <!-- Left Panel - Educational Content -->
  <div class="left-panel">
    <div class="container">
      <div class="edu-content" id="eduContent">
        <div class="edu-header">
          <span>üéì</span>
          <span>Educational Content</span>
        </div>
        <div class="edu-tabs">
          <div class="edu-tab active" onclick="switchEduTab('video')">üìπ Educational Video</div>
          <div class="edu-tab" onclick="switchEduTab('info')">üìä Information</div>
          <div class="edu-tab" onclick="switchEduTab('tips')">üí° Tips</div>
        </div>
        <div class="edu-content-area" id="eduContentArea">
          <!-- Content will be loaded dynamically -->
        </div>
      </div>
    </div>
  </div>

  <!-- Right Panel - Quiz Content -->
  <div class="right-panel">
    <div class="container" id="quizBox">
      <!-- Progress Bar -->
      <div class="progress-container">
        <div class="progress-bar" id="progressBar"></div>
      </div>
      
      <div class="question" id="question"></div>
      <ul class="options" id="options"></ul>
      
      <!-- Auto-advance notification -->
      <div class="auto-advance" id="autoAdvance" style="display: none;">
        <div>‚è∞ Auto-advancing to next question in:</div>
        <div class="countdown" id="countdown">5</div>
      </div>
    </div>

    <div class="nav">
      <button onclick="prevQuestion()">‚¨ÖÔ∏è Previous</button>
      <button onclick="nextQuestion()">Next ‚û°Ô∏è</button>
    </div>
  </div>
</div>

<div id="certificate">
  <div class="card">
    <div class="ribbon">üéâ Congratulations! üéâ</div>
    <h2>üéì Certificate of Completion</h2>
    <p>This certifies that <strong id="userName">John</strong> has successfully completed</p>
    <p><em>Food Safety Transport Training</em></p>
    <p>Final Score: <strong id="finalScore">0/0</strong></p>
    <div id="categoryStats" style="margin-top:12px"></div>
    <div class="cert-footer">
      <div class="sig-block">
        <div class="sig-text">Sharjah City Municipality ‚Äì Health Control and Safety Department</div>
        <div class="sig-line"></div>
        <div class="sig-label">Authorized Signature</div>
      </div>
      <div class="sig-block" style="max-width: 260px; align-items:flex-end;">
        <div class="sig-text" id="certDate">‚Äî</div>
        <div class="sig-line" style="width:100%"></div>
        <div class="sig-label">Date</div>
      </div>
    </div>
    <div style="margin-top:12px; display:flex; gap:12px; justify-content:center; align-items:center; flex-wrap:wrap">
      <button onclick="window.print()">üñ®Ô∏è Print Certificate</button>
      <button id="resetBtn" type="button" style="background:var(--paper);color:var(--ink);border:1px solid var(--border-color)">‚Ü∫ Reset Quiz</button>
    </div>
  </div>
</div>

<footer>
  <p>¬© 2024 Sharjah City Municipality ‚Äì Health Control and Safety Department | All Rights Reserved</p>
</footer>

<div class="modal" id="feedbackModal">
  <h3>üí° Tip</h3>
  <p id="modalContent"></p>
  <button onclick="closeModal()">Continue</button>
</div>

<script>
  let quizzes = [];
  let current = 0;
  let score = 0;
  let answered = {};
  let answeredCorrect = {};
  let autoAdvanceTimer = null;
  let currentEduTab = 'video';

  function seedFallbackQuizzes() {
    return [
      {
        id: 1,
        question: 'What is the safest temperature for transporting perishable food?',
        options: ['0-5¬∞C', '10-15¬∞C', '20-25¬∞C', 'Any temperature'],
        answer: 0,
        explanation: 'Cold chain food should generally be kept at 0-5¬∞C to prevent bacterial growth.'
      },
      {
        id: 2,
        question: 'Which practice reduces cross-contamination during transport?',
        options: ['Mix raw and cooked foods', 'Separate sealed containers', 'No labels needed', 'Use same tools'],
        answer: 1,
        explanation: 'Separate sealed containers and labeling help avoid cross-contamination.'
      },
      {
        id: 3,
        question: 'What should be done before loading food?',
        options: ['Ignore vehicle cleanliness', 'Sanitize vehicle surfaces', 'Turn off refrigeration', 'Skip checks'],
        answer: 1,
        explanation: 'Sanitizing reduces contamination risk; ensure refrigeration is functional before loading.'
      }
    ];
  }

  fetch('quizzes.json')
    .then(res => res.ok ? res.json() : Promise.reject())
    .then(data => {
      quizzes = data.quizzes || seedFallbackQuizzes();
      showQuestion();
      updateScore();
    })
    .catch(() => {
      quizzes = seedFallbackQuizzes();
      showQuestion();
      updateScore();
    });

  function createConfetti() {
    const confettiEmojis = ['üéâ', 'üéä', '‚ú®', 'üåü', 'üí´', 'üéà'];
    const container = document.getElementById('quizBox');
    
    for (let i = 0; i < 15; i++) {
      const confetti = document.createElement('div');
      confetti.className = 'confetti';
      confetti.textContent = confettiEmojis[Math.floor(Math.random() * confettiEmojis.length)];
      confetti.style.left = Math.random() * 100 + '%';
      confetti.style.animationDelay = Math.random() * 0.5 + 's';
      confetti.style.animationDuration = (Math.random() * 0.5 + 0.8) + 's';
      
      container.appendChild(confetti);
      
      // Remove confetti after animation
      setTimeout(() => {
        if (confetti.parentNode) {
          confetti.parentNode.removeChild(confetti);
        }
      }, 1500);
    }
  }

  function getTypeSymbol(type) {
    const symbols = {
      'cool': '‚ùÑÔ∏è',
      'clean': 'üßº',
      'transport': 'üöö',
      'pack': 'üì¶',
      'label': 'üè∑Ô∏è'
    };
    return symbols[type] || 'üìã';
  }

  function showQuestion() {
    const q = quizzes[current];
    if (!q) return;
    
    // Update progress bar
    updateProgressBar();
    
    // Update levels display
    updateLevelsDisplay();
    
    // Load educational content
    loadEducationalContent(q);
    
    const manualType = normalizeType(q.category);
    const type = manualType || detectType(q.question);
    const qEl = document.getElementById('question');
    const badge = type ? `<span class="qbadge ${type}">${getTypeSymbol(type)}</span>` : '';
    qEl.innerHTML = `${badge} Level ${q.id}: ${q.question}`;
    qEl.classList.add('slide-in');
    
    const box = document.getElementById('quizBox');
    box.classList.remove('qtheme-cool','qtheme-clean','qtheme-transport','qtheme-pack','qtheme-label');
    if (type) box.classList.add(`qtheme-${type}`);
    
    const optionsList = document.getElementById('options');
    optionsList.innerHTML = '';

    q.options.forEach((opt, i) => {
      const li = document.createElement('li');
      li.textContent = opt;
      li.onclick = () => {
        if (answered[current]) return;
        answered[current] = true;
        
        // Clear auto-advance timer
        if (autoAdvanceTimer) {
          clearTimeout(autoAdvanceTimer);
          autoAdvanceTimer = null;
        }
        document.getElementById('autoAdvance').style.display = 'none';
        
        if (i === q.answer) {
          li.classList.add('correct');
          li.classList.add('celebrate');
          score++;
          answeredCorrect[current] = true;
          
          // Add confetti celebration effect
          createConfetti();
        } else {
          li.classList.add('incorrect');
          if (optionsList.children[q.answer]) {
            optionsList.children[q.answer].classList.add('correct');
            optionsList.children[q.answer].classList.add('celebrate');
          }
          answeredCorrect[current] = false;
        }
        updateScore();
        updateLevelsDisplay(); // Update levels with colors
        
        // Show tip immediately
        setTimeout(() => {
          const tipText = `‚úÖ Correct Answer: ${q.options[q.answer]}\nüí¨ ${q.explanation}`;
          document.getElementById('modalContent').textContent = tipText;
          document.getElementById('feedbackModal').style.display = 'block';
        }, 1000);
      };
      optionsList.appendChild(li);
    });
  }

  function detectType(text) {
    const t = (text || '').toLowerCase();
    if (/(temp|cold|chill|cool|¬∞|c|cold chain|freeze|refriger)/.test(t)) return 'cool';
    if (/(sanitize|clean|hygiene|wash|disinfect|cleanliness)/.test(t)) return 'clean';
    if (/(transport|truck|deliver|vehicle|load|unload|route)/.test(t)) return 'transport';
    if (/(pack|seal|container|package|wrap|box)/.test(t)) return 'pack';
    if (/(label|expiry|date|trace|tag)/.test(t)) return 'label';
    return '';
  }

  function normalizeType(category) {
    if (!category) return '';
    const t = String(category).toLowerCase().trim();
    if (/^(temp|cold|cool|chill|freeze|refriger|temperature|cold\s*chain)$/.test(t)) return 'cool';
    if (/^(clean|cleaning|hygiene|wash|sanitize|sanitization|disinfect)$/.test(t)) return 'clean';
    if (/^(transport|delivery|vehicle|logistics|route|loading)$/.test(t)) return 'transport';
    if (/^(pack|packaging|seal|container|boxing|wrapping)$/.test(t)) return 'pack';
    if (/^(label|labelling|labeling|expiry|expiration|trace|traceability|tag)$/.test(t)) return 'label';
    return '';
  }

  function nextQuestion() {
    if (current < quizzes.length - 1) {
      current++;
      showQuestion();
    } else {
      showCertificate();
    }
  }

  function closeModal() {
    document.getElementById('feedbackModal').style.display = 'none';
    nextQuestion();
  }

  function prevQuestion() {
    if (current > 0) {
      current--;
      showQuestion();
    }
  }

  function updateScore() {
    const el = document.getElementById('score');
    if (el) el.textContent = `üìä Score: ${score} / ${quizzes.length}`;
  }
  
  function updateProgressBar() {
    const progress = ((current + 1) / quizzes.length) * 100;
    const progressBar = document.getElementById('progressBar');
    if (progressBar) {
      progressBar.style.width = progress + '%';
    }
  }
  
  function updateLevelsDisplay() {
    const levelsList = document.getElementById('levelsList');
    
    levelsList.innerHTML = '';
    quizzes.forEach((q, index) => {
      const levelItem = document.createElement('div');
      levelItem.className = 'level-item';
      if (index === current) levelItem.classList.add('active');
      
      // Add color coding based on answer status
      if (answered[index]) {
        if (answeredCorrect[index]) {
          levelItem.classList.add('correct');
        } else {
          levelItem.classList.add('incorrect');
        }
      }
      
      levelItem.textContent = `${q.id}`;
      levelItem.onclick = () => {
        current = index;
        showQuestion();
        updateScore();
      };
      levelsList.appendChild(levelItem);
    });
  }
  
  function loadEducationalContent(question) {
    const type = normalizeType(question.category) || detectType(question.question);
    const contentArea = document.getElementById('eduContentArea');
    
    if (currentEduTab === 'video') {
      contentArea.innerHTML = `
        <div class="video-placeholder" onclick="playVideo('${type}')">
          <div>
            <div>Watch Educational Video</div>
            <div style="font-size: 0.875rem; margin-top: 0.25rem; opacity: 0.9;">
              ${getVideoTitle(type)}
            </div>
          </div>
        </div>
      `;
    } else if (currentEduTab === 'info') {
      contentArea.innerHTML = `
        <div class="infographic-content">
          ${getInfographicContent(type)}
        </div>
      `;
    } else if (currentEduTab === 'tips') {
      contentArea.innerHTML = `
        <div style="font-family: 'Inter', sans-serif; line-height: 1.6;">
          <h4 style="color: var(--ink); margin-bottom: 1rem;">üí° Important Tips:</h4>
          ${getTipsContent(type)}
        </div>
      `;
    }
  }
  
  function switchEduTab(tab) {
    currentEduTab = tab;
    
    // Update tab styles
    document.querySelectorAll('.edu-tab').forEach(t => t.classList.remove('active'));
    event.target.classList.add('active');
    
    // Reload content
    const q = quizzes[current];
    if (q) loadEducationalContent(q);
  }
  
  function getVideoTitle(type) {
    const titles = {
      'cool': 'Temperature Control',
      'clean': 'Hygiene and Sanitization',
      'transport': 'Safe Food Transport',
      'pack': 'Packaging and Wrapping',
      'label': 'Labeling and Documentation'
    };
    return titles[type] || 'General Food Safety';
  }
  
  function getInfographicContent(type) {
    const content = {
      'cool': `
        <div class="info-card">
          <div class="info-icon">üßä</div>
          <div class="info-title">Temperature</div>
          <div class="info-desc">0-5¬∞C for chilled foods<br>-18¬∞C for frozen foods</div>
        </div>
        <div class="info-card">
          <div class="info-icon">üå°Ô∏è</div>
          <div class="info-title">Monitoring</div>
          <div class="info-desc">Check every 2 hours<br>Record readings</div>
        </div>
        <div class="info-card">
          <div class="info-icon">‚ùÑÔ∏è</div>
          <div class="info-title">Refrigeration</div>
          <div class="info-desc">Proper cooling units<br>Good thermal insulation</div>
        </div>
      `,
      'clean': `
        <div class="info-card">
          <div class="info-icon">üßº</div>
          <div class="info-title">Cleaning</div>
          <div class="info-desc">Daily thorough cleaning<br>Use sanitizing materials</div>
        </div>
        <div class="info-card">
          <div class="info-icon">ü¶†</div>
          <div class="info-title">Prevent Contamination</div>
          <div class="info-desc">Separate raw foods<br>Use separate tools</div>
        </div>
        <div class="info-card">
          <div class="info-icon">üë®‚Äçüç≥</div>
          <div class="info-title">Personal Hygiene</div>
          <div class="info-desc">Wash hands<br>Wear gloves</div>
        </div>
      `,
      'transport': `
        <div class="info-card">
          <div class="info-icon">üöö</div>
          <div class="info-title">Vehicle</div>
          <div class="info-desc">Regular maintenance<br>Thorough cleaning</div>
        </div>
        <div class="info-card">
          <div class="info-icon">üì¶</div>
          <div class="info-title">Loading</div>
          <div class="info-desc">Proper arrangement<br>Prevent damage</div>
        </div>
        <div class="info-card">
          <div class="info-icon">‚è∞</div>
          <div class="info-title">Time</div>
          <div class="info-desc">Quick delivery<br>Avoid delays</div>
        </div>
      `
    };
    return content[type] || content['transport'];
  }
  
  function getTipsContent(type) {
    const tips = {
      'cool': `
        <ul style="list-style: none; padding: 0;">
          <li>‚ùÑÔ∏è Ensure cooling equipment works before loading</li>
          <li>üå°Ô∏è Monitor temperature every 2 hours</li>
          <li>üìù Record all readings in log</li>
          <li>üö® In case of malfunction, transfer goods immediately</li>
        </ul>
      `,
      'clean': `
        <ul style="list-style: none; padding: 0;">
          <li>üßº Clean vehicle before and after each trip</li>
          <li>ü¶† Use approved sanitizing materials</li>
          <li>üë• Train workers on personal hygiene</li>
          <li>üìã Keep cleaning records</li>
        </ul>
      `,
      'transport': `
        <ul style="list-style: none; padding: 0;">
          <li>üöõ Ensure vehicle is roadworthy</li>
          <li>üì¶ Arrange goods by priority</li>
          <li>üõ£Ô∏è Choose shortest safe route</li>
          <li>‚è∞ Avoid peak hours</li>
        </ul>
      `
    };
    return tips[type] || tips['transport'];
  }
  
  function playVideo(type) {
    alert(`Educational video will play about: ${getVideoTitle(type)}\n\n(This is an example - can be linked to a real video from YouTube or any other platform)`);
  }

  function showCertificate() {
    document.getElementById('quizBox').style.display = 'none';
    document.getElementById('finalScore').textContent = `${score} / ${quizzes.length}`;
    document.getElementById('certificate').style.display = 'block';
    document.body.classList.add('certificate-mode');
    renderCategoryStats();
    const d = new Date();
    const dateStr = d.toLocaleDateString(undefined, { year: 'numeric', month: 'long', day: 'numeric' });
    const dateEl = document.getElementById('certDate');
    if (dateEl) dateEl.textContent = dateStr;
  }

  function renderCategoryStats() {
    const counters = { 
      cool: { c: 0, t: 0, icon: 'üßä', label: 'Cold Chain' }, 
      clean: { c: 0, t: 0, icon: 'üßº', label: 'Hygiene' }, 
      transport: { c: 0, t: 0, icon: 'üöö', label: 'Transport' }, 
      pack: { c: 0, t: 0, icon: 'ü•°', label: 'Packaging' }, 
      label: { c: 0, t: 0, icon: 'üè∑Ô∏è', label: 'Labeling' } 
    };
    quizzes.forEach((q, idx) => {
      const manual = normalizeType(q.category);
      const type = manual || detectType(q.question);
      const key = counters[type] ? type : null;
      if (!key) return;
      counters[key].t += 1;
      if (answeredCorrect[idx] === true) counters[key].c += 1;
    });
    const container = document.getElementById('categoryStats');
    const order = ['cool','clean','transport','pack','label'];
    const parts = order
      .filter(k => counters[k].t > 0)
      .map(k => {
        const { c, t, icon, label } = counters[k];
        return `<span style="display:inline-flex;align-items:center;gap:0.5rem;margin:0.25rem 0.5rem;padding:0.5rem 0.75rem;border-radius:9999px;background:var(--hover-bg);border:1px solid var(--border-color)">${icon} <strong>${label}</strong> <span style="opacity:.8">${c}/${t}</span></span>`;
      });
    container.innerHTML = parts.join('');
  }

  // Reset quiz flow
  document.addEventListener('click', (e) => {
    if (e.target && e.target.id === 'resetBtn') {
      resetQuiz();
    }
  });

  function resetQuiz() {
    current = 0;
    score = 0;
    answered = {};
    answeredCorrect = {};
    document.getElementById('certificate').style.display = 'none';
    document.getElementById('quizBox').style.display = 'block';
    document.body.classList.remove('certificate-mode');
    showQuestion();
    updateScore();
  }

  // Basic RTL auto-detect (Arabic locales)
  (function applyRTL() {
    try {
      const lang = (navigator.language || navigator.userLanguage || 'en').toLowerCase();
      if (lang.startsWith('ar')) {
        document.documentElement.setAttribute('dir', 'rtl');
      }
    } catch (_) {}
  })();
</script>
</body>
</html>
