<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>🚛 Food Safety Adventure – Transport Edition</title>
  <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Cairo:wght@300;400;600;700&family=Scheherazade+New:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/qrious@4.0.2/dist/qrious.min.js"></script>
  <style>
    :root {
      --primary: #8B4513; /* saddle brown - coffee tone */
      --primary-600: #654321; /* darker brown */
      --secondary: #A0522D; /* sienna - coffee brown */
      --accent: #F5F5DC; /* very light tan - much lighter coffee */
      --muted: #FEFEFE; /* very light beige - much lighter coffee latte */
      --ink: #2E2E2E;
      --ink-soft: #5D4E37;
      --paper: #ffffff;
      --success-bg: #DEB887; /* burlywood - coffee tone */
      --danger-bg: #FDECEA; /* subtle red */
      --success-border: #CD853F; /* peru - coffee tone */
      --danger-border: #F44336;
      --header-bg: transparent; /* removed header background */
      --footer-bg: #8B4513; /* coffee brown */
      --green-light: #90EE90; /* light green */
      --green-medium: #32CD32; /* lime green */
      --green-dark: #228B22; /* forest green */
    }

    html, body { height: 100%; }
    html { font-size: 72%; } /* Reduced by 20% from 90% */
    body {
      font-family: 'Arial', 'Helvetica', sans-serif;
      margin: 0;
      padding: 0;
      color: var(--ink);
      background: linear-gradient(135deg, #FEFEFE 0%, #FAF0E6 100%); /* very light coffee latte background */
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      background: var(--header-bg); /* removed background */
      color: var(--ink); /* changed to dark text */
      padding: 1.2rem 1.6rem; /* reduced by 20% */
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 3px solid var(--primary); /* separator line */
      flex-shrink: 0;
    }
    header img { height: 44.8px; } /* reduced by 20% from 56px */
    header h1 {
      flex-grow: 1;
      text-align: center;
      margin: 0;
      font-family: 'Arial', sans-serif;
      font-size: 30.4px; /* Reduced by 20% from 38px */
      letter-spacing: .4px; /* reduced by 20% */
      text-shadow: 1px 1px 2px rgba(0,0,0,0.2); /* lighter shadow */
    }
    
    /* Levels box and answers moved to top after header */
    .top-section {
      background: var(--paper);
      padding: 1rem 2rem;
      border-bottom: 2px solid var(--accent);
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 1.6rem 0; /* reduced by 20% */
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 2rem; /* reduced by 20% */
      background: var(--paper);
      border-radius: 20px; /* reduced by 20% */
      box-shadow:
        0 9.6px 32px rgba(0,0,0,0.15), /* reduced by 20% */
        0 3.2px 9.6px rgba(0,0,0,0.1); /* reduced by 20% */
      border: 2.4px solid var(--accent); /* reduced by 20% */
      position: relative;
      overflow: hidden;
      flex: 1;
    }
    
    .container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3.2px; /* reduced by 20% */
      background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent), var(--green-medium)); /* coffee and green tones */
    }

    /* Per-category theme ring for the whole question box - updated with coffee/green tones */
    #quizBox.qtheme-cool { box-shadow: 0 0 0 4.8px var(--green-light) inset, 0 0.8px 0 #00000008, 0 4.8px 11.2px rgba(0,0,0,0.10), 0 14.4px 32px rgba(0,0,0,0.08); }
    #quizBox.qtheme-clean { box-shadow: 0 0 0 4.8px var(--accent) inset, 0 0.8px 0 #00000008, 0 4.8px 11.2px rgba(0,0,0,0.10), 0 14.4px 32px rgba(0,0,0,0.08); }
    #quizBox.qtheme-transport { box-shadow: 0 0 0 4.8px var(--green-medium) inset, 0 0.8px 0 #00000008, 0 4.8px 11.2px rgba(0,0,0,0.10), 0 14.4px 32px rgba(0,0,0,0.08); }
    #quizBox.qtheme-pack { box-shadow: 0 0 0 4.8px var(--secondary) inset, 0 0.8px 0 #00000008, 0 4.8px 11.2px rgba(0,0,0,0.10), 0 14.4px 32px rgba(0,0,0,0.08); }
    #quizBox.qtheme-label { box-shadow: 0 0 0 4.8px var(--primary) inset, 0 0.8px 0 #00000008, 0 4.8px 11.2px rgba(0,0,0,0.10), 0 14.4px 32px rgba(0,0,0,0.08); }

    /* Remove gradients: keep a clean solid surface */
    #quizBox.qtheme-cool,
    #quizBox.qtheme-clean,
    #quizBox.qtheme-transport,
    #quizBox.qtheme-pack,
    #quizBox.qtheme-label { background-image: none; background: var(--paper); }

    .question {
      font-family: 'Arial', sans-serif;
      font-size: 23.2px; /* Reduced by 20% from 29px */
      color: var(--ink);
      margin-bottom: 1.28rem; /* Reduced by 20% */
      display: flex;
      align-items: center;
      gap: 8px; /* Reduced by 20% */
      line-height: 1.5;
      text-shadow: 0.8px 0.8px 1.6px rgba(0,0,0,0.1); /* reduced by 20% */
      padding: 0.8rem; /* Reduced by 20% */
      background: linear-gradient(135deg, var(--muted), var(--accent)); /* coffee latte gradient */
      border-radius: 10.4px; /* Reduced by 20% */
      border: 1.6px solid var(--accent); /* reduced by 20% */
    }
    .question::before { content: ''; }
    .qicon { display:none; }
    .qicon.cool { color: var(--green-medium); }
    .qicon.clean { color: var(--accent); }
    .qicon.transport { color: var(--green-dark); }
    .qicon.pack { color: var(--secondary); }
    .qicon.label { color: var(--primary); }

    .qbadge {
      display: inline-block;
      margin-right: 6.4px; /* reduced by 20% */
      padding: 3.2px 8px; /* reduced by 20% */
      border-radius: 999px;
      font-family: 'Cairo', sans-serif;
      font-weight: 600;
      font-size: 0.52em; /* reduced by 20% */
      vertical-align: middle;
      border: 1.6px solid #00000012; /* reduced by 20% */
      background: #fff;
    }
    .qbadge.cool { background: var(--green-light); color: var(--green-dark); }
    .qbadge.clean { background: var(--muted); color: var(--primary); }
    .qbadge.transport { background: var(--green-light); color: var(--green-dark); }
    .qbadge.pack { background: var(--accent); color: var(--primary); }
    .qbadge.label { background: var(--secondary); color: #fff; }

    .options { list-style: none; padding: 0; margin: 0; }
    .options li {
      position: relative;
      background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
      margin: 0.64rem 0; /* Reduced by 20% */
      padding: 0.88rem 1.04rem; /* Reduced by 20% */
      border-radius: 10.4px; /* Reduced by 20% */
      cursor: pointer;
      font-size: 0.664em; /* Reduced by 20% */
      font-family: 'Arial', sans-serif;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 3.2px 8.8px rgba(0,0,0,0.1), 0 1.6px 3.2px rgba(0,0,0,0.06); /* reduced by 20% */
      border: 1.6px solid var(--accent); /* reduced by 20% */
      transform: translateY(0);
    }
    
    .options li::before {
      content: '📋';
      margin-left: 6.4px; /* Reduced by 20% */
      font-size: 0.768em; /* Reduced by 20% */
    }
    .options li:hover { 
      transform: translateY(-2.4px) scale(1.02); /* reduced by 20% */
      box-shadow: 0 6.4px 20px rgba(0,0,0,0.15), 0 3.2px 6.4px rgba(0,0,0,0.08); /* reduced by 20% */
      border-color: var(--primary);
    }
    .options li::before { content: ''; }
    .options li.correct {
      background: linear-gradient(135deg, var(--success-bg) 0%, var(--green-light) 100%); /* coffee and green tones */
      border-color: var(--success-border);
      color: var(--primary);
      transform: scale(1.04); /* reduced by 20% */
      box-shadow: 0 6.4px 20px rgba(139, 69, 19, 0.3); /* coffee tone shadow */
    }
    
    .options li.correct::before {
      content: '🎉';
      font-size: 1.6em; /* reduced by 20% */
    }
    .options li.incorrect {
      background: linear-gradient(135deg, #FDECEA 0%, #FFCDD2 100%);
      border-color: #F44336;
      color: #C62828;
      transform: scale(0.984); /* reduced by 20% */
    }
    
    .options li.incorrect::before {
      content: '😔';
      font-size: 1.6em; /* reduced by 20% */
    }

    #score {
      margin-top: 0.8rem; /* reduced by 20% */
      font-weight: 700;
      color: var(--primary);
      text-align: center;
      background: linear-gradient(90deg, #fff, var(--muted));
      border-radius: 8px; /* reduced by 20% */
      padding: 6.4px 9.6px; /* reduced by 20% */
      border: 1.6px solid var(--accent); /* reduced by 20% */
      display: inline-block;
      min-width: 176px; /* reduced by 20% */
      font-size: 0.8em; /* reduced by 20% */
    }

    #certificate {
      display: none;
      text-align: center;
      padding: 1.6rem 0.96rem 2.4rem; /* reduced by 20% */
    }
    #certificate .card {
      margin: 0 auto;
      max-width: 1000px;
      background: #ffffff;
      border-radius: 9.6px; /* reduced by 20% */
      padding: 1.6rem 2rem; /* reduced by 20% */
      border: 0.8px solid #D8DFE3; /* reduced by 20% */
      box-shadow: 0 9.6px 24px rgba(0,0,0,0.08); /* reduced by 20% */
      position: relative;
    }
    #certificate .ribbon { display:none; }
    #certificate h2 {
      color: var(--secondary);
      font-size: 27.2px; /* reduced by 20% */
      font-family: 'Merriweather', serif;
      letter-spacing: .4px; /* reduced by 20% */
      margin-bottom: 0.4rem; /* reduced by 20% */
    }
    #certificate button {
      margin-top: 0.8rem; /* reduced by 20% */
      background: var(--primary);
      color: #fff;
      border: none;
      padding: 0.52rem 1rem; /* reduced by 20% */
      border-radius: 6.4px; /* reduced by 20% */
      cursor: pointer;
      font-weight: 700;
      box-shadow: 0 6.4px 12.8px rgba(0,0,0,0.12); /* reduced by 20% */
    }

    /* Certificate footer */
    .cert-footer {
      display: flex;
      justify-content: space-between;
      gap: 19.2px; /* reduced by 20% */
      margin-top: 22.4px; /* reduced by 20% */
      padding-top: 12.8px; /* reduced by 20% */
      border-top: 0.8px solid #E0E6EA; /* reduced by 20% */
    }
    .sig-block {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
    }
    .sig-text {
      color: var(--secondary);
      font-weight: 600;
      margin-bottom: 8px; /* reduced by 20% */
    }
    .sig-line {
      height: 0.8px; /* reduced by 20% */
      background: #B0BEC5;
      margin-top: 14.4px; /* reduced by 20% */
    }
    .sig-label {
      color: var(--ink-soft);
      font-size: 0.68em; /* reduced by 20% */
      margin-top: 4.8px; /* reduced by 20% */
    }

    footer {
      background: linear-gradient(90deg, var(--footer-bg), var(--accent));
      color: white;
      padding: 1.2rem 1.6rem; /* reduced by 20% */
      text-align: center;
      box-shadow: 0 -3.2px 9.6px rgba(0,0,0,0.15); /* reduced by 20% */
      flex-shrink: 0;
    }
    
    footer p {
      margin: 0;
      font-size: 0.88em; /* reduced by 20% */
      font-family: 'Cairo', sans-serif;
    }

    .nav {
      background: #ffffff;
      padding: 0.8rem; /* reduced by 20% */
      text-align: center;
      box-shadow: 0 -4.8px 12.8px rgba(0,0,0,0.06); /* reduced by 20% */
      margin-top: 1.6rem; /* reduced by 20% */
    }
    .nav button {
      background: #fff;
      color: var(--primary);
      border: 2.4px solid #00000014; /* reduced by 20% */
      padding: 0.48rem 0.88rem; /* reduced by 20% */
      margin: 0 0.32rem; /* reduced by 20% */
      border-radius: 11.2px; /* reduced by 20% */
      cursor: pointer;
      font-weight: 900;
      font-family: 'Cairo', sans-serif;
      font-size: 0.8em; /* reduced by 20% */
      box-shadow: 0 2.4px 0 #00000010, 0 8px 12.8px rgba(0,0,0,0.08); /* reduced by 20% */
      transition: transform .08s ease;
    }
    .nav button:hover { transform: translateY(-0.8px); } /* reduced by 20% */
    .nav button:active { transform: translateY(1.6px); } /* reduced by 20% */

    .modal {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #fff;
      border: 2.4px solid var(--accent); /* reduced by 20% */
      border-radius: 16px; /* reduced by 20% */
      padding: 2rem; /* reduced by 20% */
      max-width: 480px; /* reduced by 20% */
      width: 90%;
      box-shadow: 0 16px 32px rgba(0,0,0,0.2); /* reduced by 20% */
      z-index: 200;
      text-align: center;
      background-image: none;
    }
    .modal h3 { 
      margin-top: 0; 
      color: var(--primary); 
      font-family: 'Amiri', serif; 
      font-size: 32px; /* reduced by 20% */
      margin-bottom: 1.2rem; /* reduced by 20% */
    }
    .modal p {
      font-size: 1.12em; /* reduced by 20% */
      line-height: 1.6;
      margin-bottom: 1.6rem; /* reduced by 20% */
      color: var(--ink);
    }
    .modal button {
      margin-top: 0.8rem; /* reduced by 20% */
      background: var(--primary);
      color: #fff;
      border: none;
      padding: 0.8rem 1.6rem; /* reduced by 20% */
      border-radius: 12px; /* reduced by 20% */
      cursor: pointer;
      font-weight: 700;
      font-size: 0.96em; /* reduced by 20% */
      transition: all 0.3s ease;
    }
    .modal button:hover {
      background: var(--primary-600);
      transform: scale(1.05);
    }

    /* Certificate/Print adjustments */
    body.certificate-mode header img { height: 22.4px; } /* reduced by 20% */
    body.certificate-mode .nav { display: none; }
    @media print {
      @page { size: A4 landscape; margin: 8mm; } /* reduced by 20% */
      body { background: #fff !important; }
      header { box-shadow: none; }
      header img { height: 19.2px !important; } /* reduced by 20% */
      .nav, #score { display: none !important; }
      #certificate { display: block !important; }
      #quizBox, .modal { display: none !important; }
      #certificate .card { max-width: 100%; box-shadow: none; border-width: 4.8px; } /* reduced by 20% */
    }

    /* Educational Content Box */
    .edu-content {
      background: linear-gradient(135deg, var(--muted) 0%, var(--accent) 100%); /* coffee latte tones */
      border: 1.6px solid var(--primary); /* reduced by 20% */
      border-radius: 10.4px; /* Reduced by 20% */
      padding: 0.96rem; /* Reduced by 20% */
      margin: 0.96rem 0; /* Reduced by 20% */
      box-shadow: 0 4px 12.8px rgba(139, 69, 19, 0.15); /* coffee tone shadow */
      position: relative;
      overflow: hidden;
    }
    
    /* Top levels box */
    .levels-box {
      background: linear-gradient(135deg, var(--success-bg) 0%, var(--green-light) 100%); /* coffee and green tones */
      border: 1.6px solid var(--success-border); /* reduced by 20% */
      border-radius: 10.4px; /* reduced by 20% */
      padding: 0.8rem; /* reduced by 20% */
      margin: 0.8rem 0; /* reduced by 20% */
      box-shadow: 0 3.2px 9.6px rgba(139, 69, 19, 0.15); /* coffee tone shadow */
    }
    
    .levels-header {
      font-family: 'Arial', sans-serif;
      font-size: 0.96em; /* reduced by 20% */
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 0.64rem; /* reduced by 20% */
      text-align: center;
    }
    
    .levels-list {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem; /* reduced by 20% */
      justify-content: center;
    }
    
    .level-item {
      background: rgba(255,255,255,0.8);
      border: 0.8px solid var(--success-border); /* reduced by 20% */
      border-radius: 6.4px; /* reduced by 20% */
      padding: 0.32rem 0.64rem; /* reduced by 20% */
      font-size: 0.64em; /* reduced by 20% */
      font-weight: 600;
      color: var(--primary);
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .level-item:hover {
      background: var(--success-border);
      color: white;
      transform: scale(1.05);
    }
    
    .level-item.active {
      background: var(--primary);
      color: white;
    }
    
    .edu-content::before {
      content: '🎓';
      position: absolute;
      top: 8px; /* reduced by 20% */
      right: 12px; /* reduced by 20% */
      font-size: 1.6em; /* reduced by 20% */
      opacity: 0.3;
    }
    
    .edu-header {
      display: flex;
      align-items: center;
      gap: 8px; /* reduced by 20% */
      margin-bottom: 0.8rem; /* reduced by 20% */
      font-family: 'Amiri', serif;
      font-size: 1.12em; /* reduced by 20% */
      font-weight: 700;
      color: var(--primary);
    }
    
    .edu-tabs {
      display: flex;
      gap: 6.4px; /* reduced by 20% */
      margin-bottom: 0.8rem; /* reduced by 20% */
    }
    
    .edu-tab {
      padding: 6.4px 12.8px; /* reduced by 20% */
      background: rgba(255,255,255,0.7);
      border: 1.6px solid var(--primary); /* reduced by 20% */
      border-radius: 16px; /* reduced by 20% */
      cursor: pointer;
      font-family: 'Cairo', sans-serif;
      font-weight: 600;
      transition: all 0.3s ease;
      font-size: 0.72em; /* reduced by 20% */
    }
    
    .edu-tab.active {
      background: var(--primary);
      color: white;
      transform: scale(1.05);
    }
    
    .edu-tab:hover {
      background: var(--primary-600);
      color: white;
      transform: translateY(-1.6px); /* reduced by 20% */
    }
    
    .edu-content-area {
      min-height: 160px; /* reduced by 20% */
      background: rgba(255,255,255,0.8);
      border-radius: 9.6px; /* reduced by 20% */
      padding: 1.2rem; /* reduced by 20% */
      border: 0.8px solid rgba(139, 69, 19, 0.2); /* coffee tone border */
    }
    
    .video-placeholder {
      background: linear-gradient(135deg, var(--primary), var(--secondary)); /* coffee gradient */
      border-radius: 9.6px; /* reduced by 20% */
      height: 120px; /* reduced by 20% */
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-family: 'Amiri', serif;
      font-size: 0.96em; /* reduced by 20% */
      font-weight: 700;
      text-shadow: 1.6px 1.6px 3.2px rgba(0,0,0,0.3); /* reduced by 20% */
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .video-placeholder::before {
      content: '▶️';
      font-size: 2.4em; /* reduced by 20% */
      margin-left: 8px; /* reduced by 20% */
    }
    
    .video-placeholder:hover {
      transform: scale(1.05);
      box-shadow: 0 6.4px 20px rgba(0,0,0,0.2); /* reduced by 20% */
    }
    
    .infographic-content {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); /* reduced by 20% */
      gap: 0.8rem; /* reduced by 20% */
    }
    
    .info-card {
      background: linear-gradient(135deg, var(--muted), var(--accent)); /* coffee latte tones */
      border: 1.6px solid var(--primary); /* reduced by 20% */
      border-radius: 9.6px; /* reduced by 20% */
      padding: 0.8rem; /* reduced by 20% */
      text-align: center;
      transition: all 0.3s ease;
    }
    
    .info-card:hover {
      transform: translateY(-4px); /* reduced by 20% */
      box-shadow: 0 6.4px 16px rgba(139, 69, 19, 0.3); /* coffee tone shadow */
    }
    
    .info-icon {
      font-size: 2em; /* reduced by 20% */
      margin-bottom: 0.4rem; /* reduced by 20% */
    }
    
    .info-title {
      font-family: 'Amiri', serif;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 0.4rem; /* reduced by 20% */
    }
    
    .info-desc {
      font-family: 'Cairo', sans-serif;
      font-size: 0.72em; /* reduced by 20% */
      color: var(--primary-600);
      line-height: 1.4;
    }
    
    /* Auto-advance feature */
    .auto-advance {
      background: linear-gradient(135deg, var(--success-bg), var(--green-light)); /* coffee and green tones */
      border: 1.6px solid var(--success-border); /* reduced by 20% */
      border-radius: 9.6px; /* reduced by 20% */
      padding: 0.8rem; /* reduced by 20% */
      margin: 0.8rem 0; /* reduced by 20% */
      text-align: center;
      font-family: 'Cairo', sans-serif;
      font-weight: 600;
      color: var(--primary);
    }
    
    .countdown {
      font-size: 1.2em; /* reduced by 20% */
      font-weight: 700;
      color: var(--primary-600);
      margin: 0.4rem 0; /* reduced by 20% */
    }
    
    /* Progress bar */
    .progress-container {
      background: rgba(255,255,255,0.3);
      border-radius: 8px; /* reduced by 20% */
      height: 6.4px; /* reduced by 20% */
      margin: 0.8rem 0; /* reduced by 20% */
      overflow: hidden;
    }
    
    .progress-bar {
      background: linear-gradient(90deg, var(--primary), var(--secondary), var(--green-medium)); /* coffee and green tones */
      height: 100%;
      width: 0%;
      transition: width 0.5s ease;
      border-radius: 8px; /* reduced by 20% */
    }
    
    /* Animations */
    @keyframes slideInUp {
      from {
        opacity: 0;
        transform: translateY(24px); /* reduced by 20% */
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    .slide-in {
      animation: slideInUp 0.48s ease-out; /* reduced by 20% */
    }
    
    .pulse {
      animation: pulse 1.6s infinite; /* reduced by 20% */
    }
  </style>
</head>
<body>
<header>
  <img src="logo-left.png" alt="Left Logo" />
  <h1>🚛 Food Safety Adventure – Transport Edition</h1>
  <img src="logo-right.png" alt="Right Logo" />
</header>

<!-- Top section with levels box and answers moved here -->
<div class="top-section">
  <!-- Levels Box at Top -->
  <div class="levels-box" id="levelsBox">
    <div class="levels-header">🎯 Training Levels</div>
    <div class="levels-list" id="levelsList">
      <!-- Levels will be loaded dynamically -->
    </div>
  </div>
  
  <!-- Score display moved to top -->
  <div style="text-align:center; margin-top: 1rem;"><div id="score">📊 Score: 0 / 0</div></div>
</div>

<div class="main-content">
  <div class="container" id="quizBox">
  <!-- Progress Bar -->
  <div class="progress-container">
    <div class="progress-bar" id="progressBar"></div>
  </div>
  
  <div class="question" id="question"></div>
  <ul class="options" id="options"></ul>
  
  <!-- Auto-advance notification -->
  <div class="auto-advance" id="autoAdvance" style="display: none;">
    <div>⏰ Auto-advancing to next question in:</div>
    <div class="countdown" id="countdown">5</div>
  </div>
  
  <!-- Educational Content Box at Bottom -->
  <div class="edu-content" id="eduContent">
    <div class="edu-header">
      <span>🎓</span>
      <span>Educational Content</span>
    </div>
    <div class="edu-tabs">
      <div class="edu-tab active" onclick="switchEduTab('video')">📹 Educational Video</div>
      <div class="edu-tab" onclick="switchEduTab('info')">📊 Information</div>
      <div class="edu-tab" onclick="switchEduTab('tips')">💡 Tips</div>
    </div>
    <div class="edu-content-area" id="eduContentArea">
      <!-- Content will be loaded dynamically -->
    </div>
  </div>
  </div>
</div>

<div id="certificate">
  <div class="card">
    <div class="ribbon">🎉 Congratulations! 🎉</div>
    <h2>🎓 Certificate of Completion</h2>
    <p>This certifies that <strong id="userName">John</strong> has successfully completed</p>
    <p><em>Food Safety Transport Training</em></p>
    <p>Final Score: <strong id="finalScore">0/0</strong></p>
    <div id="categoryStats" style="margin-top:12px"></div>
    <div class="cert-footer">
      <div class="sig-block">
        <div class="sig-text">Sharjah City Municipality – Health Control and Safety Department</div>
        <div class="sig-line"></div>
        <div class="sig-label">Authorized Signature</div>
      </div>
      <div class="sig-block" style="max-width: 260px; align-items:flex-end;">
        <div class="sig-text" id="certDate">—</div>
        <div class="sig-line" style="width:100%"></div>
        <div class="sig-label">Date</div>
      </div>
    </div>
    <div style="margin-top:12px; display:flex; gap:12px; justify-content:center; align-items:center; flex-wrap:wrap">
      <button onclick="window.print()">🖨️ Print Certificate</button>
      <button id="resetBtn" type="button" style="background:#fff;color:#2F3A3B;border:1px solid #CBD5E1">↺ Reset Quiz</button>
    </div>
  </div>
  </div>

  <div class="nav">
    <button onclick="prevQuestion()">⬅️ Previous</button>
    <button onclick="nextQuestion()">Next ➡️</button>
  </div>
</div>

<footer>
  <p>© 2024 Sharjah City Municipality – Health Control and Safety Department | All Rights Reserved</p>
</footer>

<div class="modal" id="feedbackModal">
  <h3>💡 Tip</h3>
  <p id="modalContent"></p>
  <button onclick="closeModal()">Continue</button>
  </div>
<script>
  let quizzes = [];
  let current = 0;
  let score = 0;
  let answered = {};
  let answeredCorrect = {};
  let autoAdvanceTimer = null;
  let currentEduTab = 'video';

  function seedFallbackQuizzes() {
    return [
      {
        id: 1,
        question: 'What is the safest temperature for transporting perishable food?',
        options: ['0-5°C', '10-15°C', '20-25°C', 'Any temperature'],
        answer: 0,
        explanation: 'Cold chain food should generally be kept at 0-5°C to prevent bacterial growth.'
      },
      {
        id: 2,
        question: 'Which practice reduces cross-contamination during transport?',
        options: ['Mix raw and cooked foods', 'Separate sealed containers', 'No labels needed', 'Use same tools'],
        answer: 1,
        explanation: 'Separate sealed containers and labeling help avoid cross-contamination.'
      },
      {
        id: 3,
        question: 'What should be done before loading food?',
        options: ['Ignore vehicle cleanliness', 'Sanitize vehicle surfaces', 'Turn off refrigeration', 'Skip checks'],
        answer: 1,
        explanation: 'Sanitizing reduces contamination risk; ensure refrigeration is functional before loading.'
      }
    ];
  }

  fetch('quizzes.json')
    .then(res => res.ok ? res.json() : Promise.reject())
    .then(data => {
      quizzes = data.quizzes || seedFallbackQuizzes();
      showQuestion();
      updateScore();
    })
    .catch(() => {
      quizzes = seedFallbackQuizzes();
      showQuestion();
      updateScore();
    });

  function showQuestion() {
    const q = quizzes[current];
    if (!q) return;
    
    // Update progress bar
    updateProgressBar();
    
    // Update levels display
    updateLevelsDisplay();
    
    // Load educational content
    loadEducationalContent(q);
    
    const manualType = normalizeType(q.category);
    const type = manualType || detectType(q.question);
    const icon = '';
    const qEl = document.getElementById('question');
    const badge = type ? `<span class="qbadge ${type}">${type}</span>` : '';
    qEl.innerHTML = `${badge} Level ${q.id}: ${q.question}`;
    qEl.classList.add('slide-in');
    
    const box = document.getElementById('quizBox');
    box.classList.remove('qtheme-cool','qtheme-clean','qtheme-transport','qtheme-pack','qtheme-label');
    if (type) box.classList.add(`qtheme-${type}`);
    
    const optionsList = document.getElementById('options');
    optionsList.innerHTML = '';

    q.options.forEach((opt, i) => {
      const li = document.createElement('li');
      li.textContent = opt;
      li.onclick = () => {
        if (answered[current]) return;
        answered[current] = true;
        
        // Clear auto-advance timer
        if (autoAdvanceTimer) {
          clearTimeout(autoAdvanceTimer);
          autoAdvanceTimer = null;
        }
        document.getElementById('autoAdvance').style.display = 'none';
        
        if (i === q.answer) {
          li.classList.add('correct');
          score++;
          answeredCorrect[current] = true;
          showCelebration();
        } else {
          li.classList.add('incorrect');
          if (optionsList.children[q.answer]) {
            optionsList.children[q.answer].classList.add('correct');
          }
          answeredCorrect[current] = false;
          showDisappointment();
        }
        updateScore();
        
        // Show tip immediately
        setTimeout(() => {
          const tipText = `✅ Correct Answer: ${q.options[q.answer]}\n💬 ${q.explanation}`;
          document.getElementById('modalContent').textContent = tipText;
          document.getElementById('feedbackModal').style.display = 'block';
        }, 1000);
      };
      optionsList.appendChild(li);
    });
  }

  function detectType(text) {
    const t = (text || '').toLowerCase();
    if (/(temp|cold|chill|cool|°|c|cold chain|freeze|refriger)/.test(t)) return 'cool';
    if (/(sanitize|clean|hygiene|wash|disinfect|cleanliness)/.test(t)) return 'clean';
    if (/(transport|truck|deliver|vehicle|load|unload|route)/.test(t)) return 'transport';
    if (/(pack|seal|container|package|wrap|box)/.test(t)) return 'pack';
    if (/(label|expiry|date|trace|tag)/.test(t)) return 'label';
    return '';
  }

  function detectIcon(text) {
    const t = (text || '').toLowerCase();
    if (/(temp|cold|chill|cool|°|c|cold chain|freeze|refriger)/.test(t)) return '🧊';
    if (/(sanitize|clean|hygiene|wash|disinfect|sanitize|cleanliness)/.test(t)) return '🧼';
    if (/(transport|truck|deliver|vehicle|load|unload|route)/.test(t)) return '🚚';
    if (/(pack|seal|container|package|wrap|box)/.test(t)) return '🥡';
    if (/(label|expiry|date|trace|tag)/.test(t)) return '🏷️';
    return '🍽️';
  }

  function normalizeType(category) {
    if (!category) return '';
    const t = String(category).toLowerCase().trim();
    if (/^(temp|cold|cool|chill|freeze|refriger|temperature|cold\s*chain)$/.test(t)) return 'cool';
    if (/^(clean|cleaning|hygiene|wash|sanitize|sanitization|disinfect)$/.test(t)) return 'clean';
    if (/^(transport|delivery|vehicle|logistics|route|loading)$/.test(t)) return 'transport';
    if (/^(pack|packaging|seal|container|boxing|wrapping)$/.test(t)) return 'pack';
    if (/^(label|labelling|labeling|expiry|expiration|trace|traceability|tag)$/.test(t)) return 'label';
    return '';
  }

  function iconForType(type) {
    switch (type) {
      case 'cool': return '🧊';
      case 'clean': return '🧼';
      case 'transport': return '🚚';
      case 'pack': return '🥡';
      case 'label': return '🏷️';
      default: return '🍽️';
    }
  }

  function nextQuestion() {
    if (current < quizzes.length - 1) {
      current++;
      showQuestion();
    } else {
      showCertificate();
    }
  }

  function closeModal() {
    document.getElementById('feedbackModal').style.display = 'none';
    nextQuestion();
  }

  function prevQuestion() {
    if (current > 0) {
      current--;
      showQuestion();
    }
  }

  function updateScore() {
    const el = document.getElementById('score');
    if (el) el.textContent = `📊 Score: ${score} / ${quizzes.length}`;
  }
  
  function updateProgressBar() {
    const progress = ((current + 1) / quizzes.length) * 100;
    const progressBar = document.getElementById('progressBar');
    if (progressBar) {
      progressBar.style.width = progress + '%';
    }
  }
  
  function updateLevelsDisplay() {
    const levelsList = document.getElementById('levelsList');
    if (!levelsList) return;
    
    levelsList.innerHTML = '';
    quizzes.forEach((q, index) => {
      const levelItem = document.createElement('div');
      levelItem.className = 'level-item';
      if (index === current) levelItem.classList.add('active');
      levelItem.textContent = `Level ${q.id}`;
      levelItem.onclick = () => {
        current = index;
        showQuestion();
        updateScore();
      };
      levelsList.appendChild(levelItem);
    });
  }
  
  function loadEducationalContent(question) {
    const type = normalizeType(question.category) || detectType(question.question);
    const contentArea = document.getElementById('eduContentArea');
    
    if (currentEduTab === 'video') {
      contentArea.innerHTML = `
        <div class="video-placeholder" onclick="playVideo('${type}')">
          <div>
            <div>Watch Educational Video</div>
            <div style="font-size: 0.8em; margin-top: 5px; opacity: 0.9;">
              ${getVideoTitle(type)}
            </div>
          </div>
        </div>
      `;
    } else if (currentEduTab === 'info') {
      contentArea.innerHTML = `
        <div class="infographic-content">
          ${getInfographicContent(type)}
        </div>
      `;
    } else if (currentEduTab === 'tips') {
      contentArea.innerHTML = `
        <div style="font-family: 'Arial', sans-serif; line-height: 1.6;">
          <h4 style="color: var(--primary); margin-bottom: 1rem;">💡 Important Tips:</h4>
          ${getTipsContent(type)}
        </div>
      `;
    }
  }
  
  function switchEduTab(tab) {
    currentEduTab = tab;
    
    // Update tab styles
    document.querySelectorAll('.edu-tab').forEach(t => t.classList.remove('active'));
    event.target.classList.add('active');
    
    // Reload content
    const q = quizzes[current];
    if (q) loadEducationalContent(q);
  }
  
  function getVideoTitle(type) {
    const titles = {
      'cool': 'Temperature Control',
      'clean': 'Hygiene and Sanitization',
      'transport': 'Safe Food Transport',
      'pack': 'Packaging and Wrapping',
      'label': 'Labeling and Documentation'
    };
    return titles[type] || 'General Food Safety';
  }
  
  function getInfographicContent(type) {
    const content = {
      'cool': `
        <div class="info-card">
          <div class="info-icon">🧊</div>
          <div class="info-title">Temperature</div>
          <div class="info-desc">0-5°C for chilled foods<br>-18°C for frozen foods</div>
        </div>
        <div class="info-card">
          <div class="info-icon">🌡️</div>
          <div class="info-title">Monitoring</div>
          <div class="info-desc">Check every 2 hours<br>Record readings</div>
        </div>
        <div class="info-card">
          <div class="info-icon">❄️</div>
          <div class="info-title">Refrigeration</div>
          <div class="info-desc">Proper cooling units<br>Good thermal insulation</div>
        </div>
      `,
      'clean': `
        <div class="info-card">
          <div class="info-icon">🧼</div>
          <div class="info-title">Cleaning</div>
          <div class="info-desc">Daily thorough cleaning<br>Use sanitizing materials</div>
        </div>
        <div class="info-card">
          <div class="info-icon">🦠</div>
          <div class="info-title">Prevent Contamination</div>
          <div class="info-desc">Separate raw foods<br>Use separate tools</div>
        </div>
        <div class="info-card">
          <div class="info-icon">👨‍🍳</div>
          <div class="info-title">Personal Hygiene</div>
          <div class="info-desc">Wash hands<br>Wear gloves</div>
        </div>
      `,
      'transport': `
        <div class="info-card">
          <div class="info-icon">🚚</div>
          <div class="info-title">Vehicle</div>
          <div class="info-desc">Regular maintenance<br>Thorough cleaning</div>
        </div>
        <div class="info-card">
          <div class="info-icon">📦</div>
          <div class="info-title">Loading</div>
          <div class="info-desc">Proper arrangement<br>Prevent damage</div>
        </div>
        <div class="info-card">
          <div class="info-icon">⏰</div>
          <div class="info-title">Time</div>
          <div class="info-desc">Quick delivery<br>Avoid delays</div>
        </div>
      `
    };
    return content[type] || content['transport'];
  }
  
  function getTipsContent(type) {
    const tips = {
      'cool': `
        <ul style="list-style: none; padding: 0;">
          <li>❄️ Ensure cooling equipment works before loading</li>
          <li>🌡️ Monitor temperature every 2 hours</li>
          <li>📝 Record all readings in log</li>
          <li>🚨 In case of malfunction, transfer goods immediately</li>
        </ul>
      `,
      'clean': `
        <ul style="list-style: none; padding: 0;">
          <li>🧼 Clean vehicle before and after each trip</li>
          <li>🦠 Use approved sanitizing materials</li>
          <li>👥 Train workers on personal hygiene</li>
          <li>📋 Keep cleaning records</li>
        </ul>
      `,
      'transport': `
        <ul style="list-style: none; padding: 0;">
          <li>🚛 Ensure vehicle is roadworthy</li>
          <li>📦 Arrange goods by priority</li>
          <li>🛣️ Choose shortest safe route</li>
          <li>⏰ Avoid peak hours</li>
        </ul>
      `
    };
    return tips[type] || tips['transport'];
  }
  
  function playVideo(type) {
    alert(`Educational video will play about: ${getVideoTitle(type)}\n\n(This is an example - can be linked to a real video from YouTube or any other platform)`);
  }
  
  function showCelebration() {
    // Create celebration elements
    const celebration = document.createElement('div');
    celebration.style.cssText = `
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 3.2em;
      z-index: 1000;
      pointer-events: none;
      animation: celebrationPop 1.6s ease-out forwards;
    `;
    celebration.innerHTML = '🎉✨🎊';
    
    // Add celebration animation
    const style = document.createElement('style');
    style.textContent = `
      @keyframes celebrationPop {
        0% { opacity: 0; transform: translate(-50%, -50%) scale(0.4); }
        50% { opacity: 1; transform: translate(-50%, -50%) scale(0.96); }
        100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
      }
    `;
    document.head.appendChild(style);
    
    document.body.appendChild(celebration);
    setTimeout(() => {
      document.body.removeChild(celebration);
      document.head.removeChild(style);
    }, 1600);
  }
  
  function showDisappointment() {
    // Create disappointment element
    const disappointment = document.createElement('div');
    disappointment.style.cssText = `
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 2.4em;
      z-index: 1000;
      pointer-events: none;
      animation: disappointmentShake 1.2s ease-out forwards;
    `;
    disappointment.innerHTML = '😔💔';
    
    // Add disappointment animation
    const style = document.createElement('style');
    style.textContent = `
      @keyframes disappointmentShake {
        0% { opacity: 0; transform: translate(-50%, -50%) scale(0.64); }
        25% { opacity: 1; transform: translate(-50%, -50%) scale(0.88) rotate(-4deg); }
        50% { transform: translate(-50%, -50%) scale(0.8) rotate(4deg); }
        75% { transform: translate(-50%, -50%) scale(0.88) rotate(-2.4deg); }
        100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8) rotate(0deg); }
      }
    `;
    document.head.appendChild(style);
    
    document.body.appendChild(disappointment);
    setTimeout(() => {
      document.body.removeChild(disappointment);
      document.head.removeChild(style);
    }, 1200);
  }
  
  function startAutoAdvance() {
    let countdown = 3;
    const countdownEl = document.getElementById('countdown');
    const autoAdvanceEl = document.getElementById('autoAdvance');
    
    autoAdvanceEl.style.display = 'block';
    
    const timer = setInterval(() => {
      countdownEl.textContent = countdown;
      countdown--;
      
      if (countdown < 0) {
        clearInterval(timer);
        autoAdvanceEl.style.display = 'none';
        nextQuestion();
      }
    }, 1000);
    
    autoAdvanceTimer = timer;
  }

  function showCertificate() {
    document.getElementById('quizBox').style.display = 'none';
    document.getElementById('finalScore').textContent = `${score} / ${quizzes.length}`;
    document.getElementById('certificate').style.display = 'block';
    document.body.classList.add('certificate-mode');
    renderCategoryStats();
    const d = new Date();
    const dateStr = d.toLocaleDateString(undefined, { year: 'numeric', month: 'long', day: 'numeric' });
    const dateEl = document.getElementById('certDate');
    if (dateEl) dateEl.textContent = dateStr;
  }

  function burstConfetti(count = 40) {
    const colors = [
      'var(--primary)', 'var(--secondary)', 'var(--accent)', 'var(--green-medium)', 'var(--green-light)'
    ];
    for (let i = 0; i < count; i++) {
      const piece = document.createElement('div');
      piece.className = 'confetti';
      piece.style.left = Math.random() * 100 + 'vw';
      piece.style.background = colors[Math.floor(Math.random() * colors.length)];
      piece.style.transform = `translateY(-16px) rotate(${Math.random()*360}deg)`;
      const duration = 1.92 + Math.random() * 1.28;
      piece.style.animationDuration = duration + 's';
      piece.style.opacity = (0.7 + Math.random()*0.3).toFixed(2);
      piece.style.width = (4.8 + Math.random()*6.4) + 'px';
      piece.style.height = (6.4 + Math.random()*9.6) + 'px';
      document.body.appendChild(piece);
      setTimeout(() => piece.remove(), duration * 1000);
    }
  }

  function renderCategoryStats() {
    const counters = { 
      cool: { c: 0, t: 0, icon: '🧊', label: 'Cold Chain' }, 
      clean: { c: 0, t: 0, icon: '🧼', label: 'Hygiene' }, 
      transport: { c: 0, t: 0, icon: '🚚', label: 'Transport' }, 
      pack: { c: 0, t: 0, icon: '🥡', label: 'Packaging' }, 
      label: { c: 0, t: 0, icon: '🏷️', label: 'Labeling' } 
    };
    quizzes.forEach((q, idx) => {
      const manual = normalizeType(q.category);
      const type = manual || detectType(q.question);
      const key = counters[type] ? type : null;
      if (!key) return;
      counters[key].t += 1;
      if (answeredCorrect[idx] === true) counters[key].c += 1;
    });
    const container = document.getElementById('categoryStats');
    const order = ['cool','clean','transport','pack','label'];
    const parts = order
      .filter(k => counters[k].t > 0)
      .map(k => {
        const { c, t, icon, label } = counters[k];
        return `<span style="display:inline-flex;align-items:center;gap:4.8px;margin:3.2px 6.4px;padding:4.8px 8px;border-radius:999px;background:#ffffffcc;border:0.8px solid #00000012">${icon} <strong>${label}</strong> <span style="opacity:.8">${c}/${t}</span></span>`;
      });
    container.innerHTML = parts.join('');
  }

  // Reset quiz flow
  document.addEventListener('click', (e) => {
    if (e.target && e.target.id === 'resetBtn') {
      resetQuiz();
    }
  });

  function resetQuiz() {
    current = 0;
    score = 0;
    answered = {};
    answeredCorrect = {};
    document.getElementById('certificate').style.display = 'none';
    document.getElementById('quizBox').style.display = 'block';
    document.body.classList.remove('certificate-mode');
    showQuestion();
    updateScore();
  }

  // Basic RTL auto-detect (Arabic locales)
  (function applyRTL() {
    try {
      const lang = (navigator.language || navigator.userLanguage || 'en').toLowerCase();
      if (lang.startsWith('ar')) {
        document.documentElement.setAttribute('dir', 'rtl');
      }
    } catch (_) {}
  })();
</script>
</body>
</html>
